# éé¢„è®¾å‡ºèº«èœå•å®ç°å®Œæˆæ€»ç»“

## âœ… å·²å®Œæˆçš„æ‰€æœ‰å·¥ä½œ

### 1. æ ¸å¿ƒå…¬å…±èœå•ï¼ˆ3ä¸ªï¼‰

#### âœ… æŠ€èƒ½èƒŒæ™¯èœå•ï¼ˆ8ä¸ªé€‰é¡¹ï¼‰
- **èœå•ID**: `non_preset_skill_background`
- **é€‰é¡¹**:
  - `bg_herd_hunt` - æ”¾ç‰§ä¸ç‹©çŒ
  - `bg_village_defense` - æ‘åº„è‡ªå«
  - `bg_caravan_guard` - å•†é˜ŸæŠ¤å«
  - `bg_merc_helper` - é›‡ä½£å…µæ‚å½¹
  - `bg_border_patrol` - è¾¹å¢ƒå·¡é€»
  - `bg_city_apprentice` - åŸé•‡å­¦å¾’
  - `bg_poach_smuggle` - å·çŒ/èµ°ç§
  - `bg_conscripted` - ä¸´æ—¶å¾å¬å…µ
- **OnSelectå›è°ƒ**: `NonPresetSkillBackgroundOnSelect` - å­˜å‚¨åˆ°`SelectedNonPresetOriginNodes["np_node_skill_background"]`

#### âœ… å½“å‰çŠ¶æ€èœå•ï¼ˆ6ä¸ªé€‰é¡¹ï¼‰
- **èœå•ID**: `non_preset_starting_condition`
- **é€‰é¡¹**:
  - `sc_alone` - å­¤èº«ä¸€äººï¼ˆæœ€é«˜è‡ªç”±ï¼‰
  - `sc_with_friends` - å¸¦1-2ååŒä¹¡
  - `sc_with_commoners` - å¸¦3-5åå¹³æ°‘
  - `sc_cash_start` - å°‘é‡å¯åŠ¨èµ„é‡‘ï¼ˆæ— äººï¼‰
  - `sc_in_debt` - æ¬ å€ºå¼€å±€ï¼ˆé«˜å‹ä½†æœ‰é’±ï¼‰
  - `sc_injured_or_tired` - è½»ä¼¤/ç–²æƒ«å¼€å±€ï¼ˆæ²‰æµ¸éš¾ï¼‰
- **OnSelectå›è°ƒ**: `NonPresetStartingConditionOnSelect` - å­˜å‚¨åˆ°`SelectedNonPresetOriginNodes["np_node_starting_condition"]`

### 2. å¯é€‰å…¬å…±èŠ‚ç‚¹èœå•ï¼ˆ3ä¸ªï¼‰

#### âœ… èµ·å§‹ä½ç½®ç±»å‹èœå•ï¼ˆ4ä¸ªé€‰é¡¹ï¼‰
- **èœå•ID**: `non_preset_start_location_type`
- **é€‰é¡¹**:
  - `loc_rural_edge` - ä¹¡æ‘è¾¹ç¼˜
  - `loc_town_outskirts` - åŸé•‡å¤–å›´
  - `loc_trade_road` - å•†è·¯æ²¿çº¿
  - `loc_border_wild` - è¾¹å¢ƒè’é‡
- **OnSelectå›è°ƒ**: å­˜å‚¨åˆ°`SelectedNonPresetOriginNodes["np_node_start_location_type"]`

#### âœ… è´µé‡ç‰©å“èœå•ï¼ˆ4ä¸ªé€‰é¡¹ï¼‰
- **èœå•ID**: `non_preset_valuable_item`
- **é€‰é¡¹**:
  - `val_good_knife` - ä¸€æŠŠè¿˜ç®—åƒæ ·çš„åˆ€
  - `val_warm_coat` - ä¸€ä»¶åšä¸€ç‚¹çš„å¤–å¥—
  - `val_pack_mule` - ä¸€åŒ¹ç ´é©®é©¬
  - `val_small_savings` - ä¸€ç‚¹ç§¯è“„
- **OnSelectå›è°ƒ**: å­˜å‚¨åˆ°`SelectedNonPresetOriginNodes["np_node_valuable_item"]`

#### âœ… è”ç³»äººç±»å‹èœå•ï¼ˆ4ä¸ªé€‰é¡¹ï¼‰
- **èœå•ID**: `non_preset_contact_type`
- **é€‰é¡¹**:
  - `ct_caravan_contact` - å•†é˜Ÿç†Ÿäºº
  - `ct_workshop_contact` - å·¥åŠç†Ÿäºº
  - `ct_officer_contact` - é€€ä¼å†›å®˜ç†Ÿäººï¼ˆæ³›åŒ–ï¼‰
  - `ct_none` - æ²¡æœ‰
- **OnSelectå›è°ƒ**: å­˜å‚¨åˆ°`SelectedNonPresetOriginNodes["np_node_contact_type"]`

### 3. ç§æœ‰èŠ‚ç‚¹èœå•ï¼ˆ5ä¸ªï¼‰

#### âœ… æ¸¸ç‰§è¥åœ°è§’è‰²èœå•ï¼ˆ4ä¸ªé€‰é¡¹ï¼‰
- **èœå•ID**: `non_preset_nomad_role`
- **é€‰é¡¹**:
  - `nomad_role_scout` - æ”¾å“¨ä¸æ¢è·¯
  - `nomad_role_vet` - å…½åŒ»/ç…§æ–™ç‰²ç•œ
  - `nomad_role_horse_handler` - ç‰µé©¬ä¸é©­é©¬
  - `nomad_role_guard` - è¥åœ°æŠ¤å«
- **OnSelectå›è°ƒ**: å­˜å‚¨åˆ°`SelectedNonPresetOriginNodes["np_node_nomad_role"]`
- **è§¦å‘æ¡ä»¶**: é€‰æ‹©`social_origin_nomad_camp`

#### âœ… æ‰‹å·¥ä¸šè€…æ‰‹è‰ºèœå•ï¼ˆ4ä¸ªé€‰é¡¹ï¼‰
- **èœå•ID**: `non_preset_artisan_trade`
- **é€‰é¡¹**:
  - `artisan_trade_smith` - é“åŒ å­¦å¾’
  - `artisan_trade_leather` - çš®åŒ /åˆ¶ç”²å­¦å¾’
  - `artisan_trade_carpenter` - æœ¨åŒ /è½¦æ¶å­¦å¾’
  - `artisan_trade_clerk` - è´¦æˆ¿/è·‘è…¿å­¦å¾’
- **OnSelectå›è°ƒ**: å­˜å‚¨åˆ°`SelectedNonPresetOriginNodes["np_node_artisan_trade"]`
- **è§¦å‘æ¡ä»¶**: é€‰æ‹©`social_origin_urban_artisan`

#### âœ… å•†é˜ŸèŒè´£èœå•ï¼ˆ4ä¸ªé€‰é¡¹ï¼‰
- **èœå•ID**: `non_preset_caravan_duty`
- **é€‰é¡¹**:
  - `caravan_duty_guide` - å¸¦è·¯ä¸çœ‹å¤©
  - `caravan_duty_guard` - æŠ¤å«
  - `caravan_duty_muleteer` - é©®å…½ä¸è´§ç‰©ç®¡ç†
  - `caravan_duty_broker` - è®¨ä»·è¿˜ä»·/è”ç»œ
- **OnSelectå›è°ƒ**: å­˜å‚¨åˆ°`SelectedNonPresetOriginNodes["np_node_caravan_duty"]`
- **è§¦å‘æ¡ä»¶**: é€‰æ‹©`social_origin_caravan_follower`

#### âœ… å°æ°æ—ä½ç½®èœå•ï¼ˆ4ä¸ªé€‰é¡¹ï¼‰
- **èœå•ID**: `non_preset_minor_clan_position`
- **é€‰é¡¹**:
  - `clan_pos_hostage` - ç¤¼èŠ‚æ€§"äººè´¨"
  - `clan_pos_client` - é—¨å®¢/ä¾ä»
  - `clan_pos_bastard` - ç§ç”Ÿå­/è¾¹ç¼˜è¡€è„‰
  - `clan_pos_ignored` - è¢«å¿½è§†çš„æ—æ”¯
- **OnSelectå›è°ƒ**: å­˜å‚¨åˆ°`SelectedNonPresetOriginNodes["np_node_minor_clan_position"]`
- **è§¦å‘æ¡ä»¶**: é€‰æ‹©`social_origin_minor_clan`

#### âœ… æµæµªéš¾æ°‘è´Ÿæ‹…èœå•ï¼ˆ4ä¸ªé€‰é¡¹ï¼‰
- **èœå•ID**: `non_preset_refugee_burden`
- **é€‰é¡¹**:
  - `ref_burden_sick` - æœ‰ç—…äººè¦ç…§é¡¾
  - `ref_burden_child` - å¸¦ç€å­©å­/å®¶çœ·
  - `ref_burden_owed` - æ¬ äººæƒ…/æ¬ å‘½
  - `ref_burden_nothing` - ä»€ä¹ˆéƒ½æ²¡äº†
- **OnSelectå›è°ƒ**: å­˜å‚¨åˆ°`SelectedNonPresetOriginNodes["np_node_refugee_burden"]`
- **è§¦å‘æ¡ä»¶**: é€‰æ‹©`social_origin_wanderer`

### 4. è·¯ç”±é€»è¾‘æ›´æ–°

#### âœ… ResolveNextMenuIdæ–¹æ³•æ›´æ–°
- **ç¤¾ä¼šå‡ºèº«èœå•** â†’ æ ¹æ®`NeedsFlavorNode()`åˆ¤æ–­æ˜¯å¦éœ€è¦é£å‘³èŠ‚ç‚¹
- **é£å‘³èŠ‚ç‚¹èœå•** â†’ æŠ€èƒ½èƒŒæ™¯èœå•
- **æŠ€èƒ½èƒŒæ™¯èœå•** â†’ å½“å‰çŠ¶æ€èœå•
- **å½“å‰çŠ¶æ€èœå•** â†’ å¯é€‰èŠ‚ç‚¹æˆ–ç›´æ¥å®Œæˆ

#### âœ… GetFlavorNodeMenuIdæ–¹æ³•æ›´æ–°
- æ”¯æŒæ‰€æœ‰5ä¸ªç§æœ‰èŠ‚ç‚¹èœå•çš„è·¯ç”±ï¼š
  - `nomad_camp` â†’ `non_preset_nomad_role`
  - `urban_artisan` â†’ `non_preset_artisan_trade`
  - `caravan_follower` â†’ `non_preset_caravan_duty`
  - `minor_clan` â†’ `non_preset_minor_clan_position`
  - `wanderer` â†’ `non_preset_refugee_burden`

### 5. èœå•æ³¨å†Œ

æ‰€æœ‰æ–°èœå•å·²åœ¨`OnNarrativeMenusCreated`ä¸­æ³¨å†Œï¼š
- âœ… å°æ°æ—ä½ç½®èœå•
- âœ… æµæµªéš¾æ°‘è´Ÿæ‹…èœå•
- âœ… èµ·å§‹ä½ç½®ç±»å‹èœå•
- âœ… è´µé‡ç‰©å“èœå•
- âœ… è”ç³»äººç±»å‹èœå•

## ğŸ“‹ æ•°æ®å­˜å‚¨

æ‰€æœ‰é€‰æ‹©éƒ½å­˜å‚¨åˆ°`OriginSystemHelper.SelectedNonPresetOriginNodes`å­—å…¸ä¸­ï¼š
- `np_node_social_origin` - ç¤¾ä¼šå‡ºèº«
- `np_node_skill_background` - æŠ€èƒ½èƒŒæ™¯
- `np_node_starting_condition` - å½“å‰çŠ¶æ€
- `np_node_start_location_type` - èµ·å§‹ä½ç½®ç±»å‹ï¼ˆå¯é€‰ï¼‰
- `np_node_valuable_item` - è´µé‡ç‰©å“ï¼ˆå¯é€‰ï¼‰
- `np_node_contact_type` - è”ç³»äººç±»å‹ï¼ˆå¯é€‰ï¼‰
- `np_node_nomad_role` - æ¸¸ç‰§è¥åœ°è§’è‰²ï¼ˆç§æœ‰ï¼‰
- `np_node_artisan_trade` - æ‰‹å·¥ä¸šè€…æ‰‹è‰ºï¼ˆç§æœ‰ï¼‰
- `np_node_caravan_duty` - å•†é˜ŸèŒè´£ï¼ˆç§æœ‰ï¼‰
- `np_node_minor_clan_position` - å°æ°æ—ä½ç½®ï¼ˆç§æœ‰ï¼‰
- `np_node_refugee_burden` - æµæµªéš¾æ°‘è´Ÿæ‹…ï¼ˆç§æœ‰ï¼‰

## ğŸ”„ æµç¨‹è¯´æ˜

### åŸºç¡€æµç¨‹ï¼ˆ3æ­¥ï¼‰
1. **ç¤¾ä¼šå‡ºèº«** (`non_preset_social_origin`)
2. **æŠ€èƒ½èƒŒæ™¯** (`non_preset_skill_background`)
3. **å½“å‰çŠ¶æ€** (`non_preset_starting_condition`)

### å®Œæ•´æµç¨‹ï¼ˆåŒ…å«å¯é€‰èŠ‚ç‚¹ï¼‰
1. **ç¤¾ä¼šå‡ºèº«** â†’ å¯èƒ½éœ€è¦**ç§æœ‰èŠ‚ç‚¹**ï¼ˆæ ¹æ®é€‰æ‹©ï¼‰
2. **æŠ€èƒ½èƒŒæ™¯**
3. **å½“å‰çŠ¶æ€** â†’ å¯ä»¥è¿›å…¥**å¯é€‰èŠ‚ç‚¹**ï¼ˆèµ·å§‹ä½ç½®ã€è´µé‡ç‰©å“ã€è”ç³»äººç±»å‹ï¼‰
4. **å®Œæˆ**

## âœ… ç¼–è¯‘æ£€æŸ¥

æ‰€æœ‰ä»£ç å·²é€šè¿‡ç¼–è¯‘æ£€æŸ¥ï¼Œæ— é”™è¯¯ã€‚

## ğŸš€ ä¸‹ä¸€æ­¥å»ºè®®

1. **æµ‹è¯•æ‰€æœ‰èœå•** - åœ¨æ¸¸æˆä¸­æµ‹è¯•æ¯ä¸ªèœå•çš„æ˜¾ç¤ºå’Œé€‰æ‹©
2. **æ•ˆæœåº”ç”¨** - ç¡®ä¿`NonPresetOriginSystem`ä¸­çš„æ•ˆæœåº”ç”¨é€»è¾‘æ­£ç¡®
3. **å¯é€‰èŠ‚ç‚¹é›†æˆ** - å®ç°å¯é€‰èŠ‚ç‚¹çš„æ˜¾ç¤ºé€»è¾‘ï¼ˆå½“å‰çŠ¶æ€é€‰æ‹©åæ˜¯å¦æ˜¾ç¤ºå¯é€‰èŠ‚ç‚¹ï¼‰
4. **æ•ˆæœéªŒè¯** - éªŒè¯æ‰€æœ‰é€‰æ‹©çš„æ•ˆæœæ˜¯å¦æ­£ç¡®åº”ç”¨

## ğŸ“ æ–‡ä»¶æ¸…å•

### å·²æ›´æ–°çš„æ–‡ä»¶
1. `OriginSystemMod/SubModule/OriginSystemPatches.cs`
   - æ›´æ–°äº†æŠ€èƒ½èƒŒæ™¯èœå•ï¼ˆ8ä¸ªé€‰é¡¹ï¼‰
   - æ›´æ–°äº†å½“å‰çŠ¶æ€èœå•ï¼ˆ6ä¸ªé€‰é¡¹ï¼‰
   - æ›´æ–°äº†æ¸¸ç‰§è¥åœ°è§’è‰²èœå•ï¼ˆ4ä¸ªé€‰é¡¹ï¼‰
   - æ›´æ–°äº†æ‰‹å·¥ä¸šè€…æ‰‹è‰ºèœå•ï¼ˆ4ä¸ªé€‰é¡¹ï¼‰
   - æ›´æ–°äº†å•†é˜ŸèŒè´£èœå•ï¼ˆ4ä¸ªé€‰é¡¹ï¼‰
   - åˆ›å»ºäº†å°æ°æ—ä½ç½®èœå•ï¼ˆ4ä¸ªé€‰é¡¹ï¼‰
   - åˆ›å»ºäº†æµæµªéš¾æ°‘è´Ÿæ‹…èœå•ï¼ˆ4ä¸ªé€‰é¡¹ï¼‰
   - åˆ›å»ºäº†èµ·å§‹ä½ç½®ç±»å‹èœå•ï¼ˆ4ä¸ªé€‰é¡¹ï¼‰
   - åˆ›å»ºäº†è´µé‡ç‰©å“èœå•ï¼ˆ4ä¸ªé€‰é¡¹ï¼‰
   - åˆ›å»ºäº†è”ç³»äººç±»å‹èœå•ï¼ˆ4ä¸ªé€‰é¡¹ï¼‰
   - æ›´æ–°äº†æ‰€æœ‰OnSelectå›è°ƒæ–¹æ³•
   - æ›´æ–°äº†è·¯ç”±é€»è¾‘

### æ–°åˆ›å»ºçš„æ–‡æ¡£
1. `OriginSystemMod/éé¢„è®¾å‡ºèº«èœå•å®ç°å®Œæˆæ€»ç»“.md` - æœ¬æ–‡ä»¶

---

**å®Œæˆæ—¶é—´**: 2024å¹´
**å®Œæˆå†…å®¹**: éé¢„è®¾å‡ºèº«ç³»ç»Ÿçš„æ‰€æœ‰èœå•åˆ›å»ºã€å›è°ƒæ–¹æ³•å’Œè·¯ç”±é€»è¾‘








































