# âš ï¸ å¿…è¯»ï¼šé”™è¯¯æ•™è®­å’Œå¼€å‘è§„åˆ™

**âš ï¸âš ï¸âš ï¸ æ¯æ¬¡å¼€å§‹å·¥ä½œå‰å¿…é¡»å®Œæ•´é˜…è¯»æ­¤æ–‡æ¡£ï¼âš ï¸âš ï¸âš ï¸**

**âš ï¸âš ï¸âš ï¸ è¿™æ˜¯æœ€é«˜ä¼˜å…ˆçº§æ–‡æ¡£ï¼Œå¿…é¡»å…ˆè¯»å†åŠ¨æ‰‹ï¼âš ï¸âš ï¸âš ï¸**

---

## ğŸ“‹ ç›®å½•

1. [æ ¸å¿ƒåŸåˆ™](#æ ¸å¿ƒåŸåˆ™)
2. [ç‰ˆæœ¬åŸºçº¿å’Œå¯å›æ»šç‚¹](#ç‰ˆæœ¬åŸºçº¿å’Œå¯å›æ»šç‚¹) â­ æ–°å¢
3. [æˆ‘çŠ¯ä¸‹çš„ä¸¥é‡é”™è¯¯](#æˆ‘çŠ¯ä¸‹çš„ä¸¥é‡é”™è¯¯)
4. [ç”¨æˆ·å’Œ ChatGPT çš„æ•™è‚²](#ç”¨æˆ·å’Œ-chatgpt-çš„æ•™è‚²)
5. [ç¡¬æ€§ç¦æ­¢äº‹é¡¹](#ç¡¬æ€§ç¦æ­¢äº‹é¡¹)
6. [å¿…é¡»éµå®ˆçš„æµç¨‹](#å¿…é¡»éµå®ˆçš„æµç¨‹)
7. [PatchAll éš”ç¦»ç­–ç•¥æ¨¡æ¿](#patchall-éš”ç¦»ç­–ç•¥æ¨¡æ¿) â­ æ–°å¢
8. [æ—¥å¿—å…³é”®è¯ç»Ÿä¸€ç®¡ç†](#æ—¥å¿—å…³é”®è¯ç»Ÿä¸€ç®¡ç†) â­ æ–°å¢
9. [è·¯ç”±æ•°æ®ä¸å˜é‡æ£€æŸ¥](#è·¯ç”±æ•°æ®ä¸å˜é‡æ£€æŸ¥) â­ æ–°å¢
10. [è¿è¡Œæ—¶éªŒè¯æ ‡å‡†](#è¿è¡Œæ—¶éªŒè¯æ ‡å‡†) â­ æ–°å¢
11. [API/ç±»å‹å¼•ç”¨è‡ªæŸ¥æ¸…å•](#apitypeå¼•ç”¨è‡ªæŸ¥æ¸…å•) â­ æ–°å¢
12. [äº¤ä»˜å¤±è´¥æ¡ä»¶](#äº¤ä»˜å¤±è´¥æ¡ä»¶) â­ æ–°å¢
13. [æ ‡å‡†éªŒè¯æ¨¡æ¿](#æ ‡å‡†éªŒè¯æ¨¡æ¿) â­ æ–°å¢
14. [æ—¥å¿—è·¯å¾„å’ŒæŸ¥æ‰¾æ–¹æ³•](#æ—¥å¿—è·¯å¾„å’ŒæŸ¥æ‰¾æ–¹æ³•)

---

## ğŸ¯ æ ¸å¿ƒåŸåˆ™

### åŸåˆ™1ï¼šä¿å®ˆä¿®å¤ï¼Œä¸è¦é‡æ„
- **æ°¸è¿œä»¥"old-good"ç‰ˆæœ¬ä¸ºçœŸç›¸ï¼ˆground truthï¼‰**
- **åªåšæœ€å°åŒ–ä¿®å¤ï¼ˆsurgical fixï¼‰ï¼Œæ¯ä¸ªæ”¹åŠ¨å°½é‡ â‰¤ 20 è¡Œ**
- **ç¦æ­¢"ä¸ºäº†æ›´å¹²å‡€"è€Œé‡æ„ã€é‡å‘½åã€æŠ½è±¡å°è£…**
- **ç¦æ­¢"æˆ‘è§‰å¾—åº”è¯¥è¿™æ ·æ›´åˆç†"çš„æ”¹åŠ¨**

### åŸåˆ™2ï¼šå…ˆå¯¹æ¯”ï¼Œå†ä¿®å¤
- **å¿…é¡»å…ˆåšå·®å¼‚å¯¹æ¯”ï¼ˆdiff-drivenï¼‰**
- **æ‰¾åˆ°"æœ€åä¸€æ¬¡èƒ½å®ç°"çš„ç‰ˆæœ¬ä½œä¸ºæ ‡å‡†ç­”æ¡ˆ**
- **åªä¿®å¤"ä¸åŠŸèƒ½ä¸ç”Ÿæ•ˆç›´æ¥ç›¸å…³"çš„å·®å¼‚**
- **ç¦æ­¢é¡ºæ‰‹æ•´ç†ä»£ç /é‡å‘½å/æŠ½è±¡å°è£…**

### åŸåˆ™3ï¼šç”¨æ—¥å¿—è¯æ˜ï¼Œä¸è¦çŒœæµ‹
- **æ‰€æœ‰ä¿®å¤å¿…é¡»ç”¨è¿è¡Œæ—¥å¿—è¯æ˜"çœŸçš„æ‰§è¡Œåˆ°å¹¶ç”Ÿæ•ˆ"**
- **ç¦æ­¢åªç»™ç†è®ºåˆ†æä¸è·‘æ—¥å¿—**
- **æ—¥å¿—å¿…é¡»æ˜¯"å¯è¯ä¼ª"çš„ï¼šå¿…é¡»æ‰“å°å…³é”®çŠ¶æ€å€¼**

### åŸåˆ™4ï¼šç¼–è¯‘é€šè¿‡æ˜¯åº•çº¿
- **0 errors 0 warnings æ˜¯å¿…é¡»çš„**
- **ç¦æ­¢å¼•å…¥æœªå¼•ç”¨çš„ç±»å‹ï¼ˆDebug / CultureObject è¿™ç±»é”™è¯¯å†å‡ºç°ä¸€æ¬¡å°±æ˜¯å¤±è´¥ï¼‰**
- **ä¿®æ”¹åå¿…é¡»æœ¬åœ°è‡ªæŸ¥å¹¶ç»™å‡ºç»“æœ**

---

## ğŸ”– ç‰ˆæœ¬åŸºçº¿å’Œå¯å›æ»šç‚¹ â­ æ–°å¢

### å¿…é¡»éµå®ˆçš„ç‰ˆæœ¬ç®¡ç†è§„åˆ™

**æ¯æ¬¡ä¿®å¤å‰å¿…é¡»å…ˆç¡®è®¤ï¼š**

1. **è®°å½•å½“å‰çŠ¶æ€ï¼š**
   ```bash
   # è®°å½• current-bad çš„ commit hash
   git log -1 --format="%H %s" > current_bad_state.txt
   
   # è®°å½•å˜æ›´è§„æ¨¡
   git diff --stat > current_changes_stat.txt
   ```

2. **é”å®š old-good ç‰ˆæœ¬ï¼š**
   ```bash
   # æ‰¾åˆ°æœ€åä¸€æ¬¡èƒ½å·¥ä½œçš„ commit
   # è®°å½• old-good çš„ commit hash
   git log --oneline | grep "èƒ½å·¥ä½œ\|working\|good" > old_good_candidates.txt
   
   # æˆ–è€…æ‰“ tag
   git tag baseline_good_$(date +%Y%m%d) <commit-hash>
   ```

3. **ç¡®ä¿å¯å›æ»šï¼š**
   ```bash
   # æ¯æ¬¡å°è¯•å¤±è´¥å¿…é¡»èƒ½ä¸€é”®å›æ»š
   git checkout <old-good-hash>
   # æˆ–
   git checkout baseline_good_YYYYMMDD
   ```

**ç¡¬æ€§è¦æ±‚ï¼š**
- âŒ **ç¦æ­¢åœ¨æ²¡æœ‰è®°å½• old-good commit hash çš„æƒ…å†µä¸‹å¼€å§‹ä¿®å¤**
- âŒ **ç¦æ­¢åœ¨æ²¡æœ‰å¯å›æ»šç‚¹çš„æƒ…å†µä¸‹è¿›è¡Œå¤§èŒƒå›´æ”¹åŠ¨**
- âœ… **æ¯æ¬¡æ”¹åŠ¨å‰å¿…é¡»å…ˆ `git diff --stat` è®°å½•å˜æ›´è§„æ¨¡**
- âœ… **æ¯æ¬¡å°è¯•å¤±è´¥å¿…é¡»èƒ½ä¸€é”®å›æ»šåˆ° old-good**

**è¿™èƒ½ç›´æ¥é˜²æ­¢"è¶Šä¿®è¶Šä¹±"ã€‚**

---

## ğŸ’¥ æˆ‘çŠ¯ä¸‹çš„ä¸¥é‡é”™è¯¯

### é”™è¯¯1ï¼šæ—¥å¿—è·¯å¾„å†™é”™
**é”™è¯¯è¡Œä¸ºï¼š**
- æˆ‘å†™æˆäº† `%USERPROFILE%\Documents\Mount and Blade II Bannerlord\Logs\`
- æˆ‘å†™æˆäº† `D:\SteamLibrary\...\Modules\crashes\logs\`

**æ­£ç¡®ä½ç½®ï¼š**
- `C:\ProgramData\Mount and Blade II Bannerlord\logs\`ï¼ˆæ³¨æ„æ˜¯å°å†™ logsï¼‰
- æ—¥å¿—æ–‡ä»¶æ ¼å¼æ˜¯ `rgl_log_*.txt`ï¼Œä¸æ˜¯ `.log`

**æ•™è®­ï¼š**
- **ä¸è¦å‡è®¾ï¼Œè¦éªŒè¯ï¼**
- **ç”¨æˆ·è¯´åœ¨å“ªé‡Œå°±åœ¨å“ªé‡Œï¼**
- **ä¸è¦è‡ªä½œèªæ˜æ”¹è·¯å¾„ï¼**

### é”™è¯¯2ï¼šæ—¥å¿—å…³é”®è¯ä¸åŒ¹é…
**é”™è¯¯è¡Œä¸ºï¼š**
- æˆ‘åˆ—å‡ºçš„æ—¥å¿—å…³é”®è¯ï¼ˆå¦‚ `[Route] ä½¿ç”¨ PendingMenuSwitch`ï¼‰åœ¨å®é™…ä»£ç ä¸­æ ¹æœ¬ä¸å­˜åœ¨
- æˆ‘åˆ—å‡ºçš„ `Switch: cur=...` æ ¼å¼ä¸å¯¹

**æ­£ç¡®å…³é”®è¯ï¼ˆä»å®é™…ä»£ç ä¸­æå–ï¼‰ï¼š**
- `Select: menu=` ï¼ˆOnNarrativeMenuOptionSelected Prefixï¼‰
- `Postfix: å½“å‰èœå• =` ï¼ˆOnNarrativeMenuOptionSelected Postfixï¼‰
- `Switch: cur=` ï¼ˆTrySwitchToNextMenu Prefixï¼‰
- `[Route] ä½¿ç”¨ PendingMenuSwitch:` ï¼ˆOriginMenuRouter.ResolveNextMenuIdï¼‰
- `ForceSwitch: target=` ï¼ˆTrySwitchToNextMenu å¼ºåˆ¶åˆ‡æ¢ï¼‰

**æ•™è®­ï¼š**
- **å¿…é¡»ä»å®é™…ä»£ç ä¸­æå–æ—¥å¿—å…³é”®è¯ï¼Œä¸è¦è‡ªå·±ç¼–ï¼**
- **å…ˆè¯»ä»£ç ï¼Œå†å†™æ–‡æ¡£ï¼**

### é”™è¯¯3ï¼šHarmony PatchAll å¤±è´¥å¯¼è‡´æ‰€æœ‰ Patch æœªæ³¨å†Œ
**é”™è¯¯è¡Œä¸ºï¼š**
- `OnCharacterCreationFinalizedPatch.TargetMethod()` æŠ›å¼‚å¸¸
- å¯¼è‡´æ•´ä¸ª `Harmony.PatchAll()` å¤±è´¥
- æ‰€æœ‰ Patch éƒ½æ²¡æœ‰æ³¨å†Œï¼ˆåŒ…æ‹¬è·¯ç”±ç›¸å…³çš„ Patchï¼‰
- ç»“æœï¼šè·¯ç”±å®Œå…¨å¤±æ•ˆ

**ä¿®å¤æ–¹æ³•ï¼š**
- åœ¨ `TargetMethod()` ä¸­æ·»åŠ å®Œæ•´çš„ try-catch
- ç¡®ä¿å³ä½¿æŸ¥æ‰¾æ–¹æ³•å¤±è´¥ä¹Ÿä¸æŠ›å¼‚å¸¸
- è¿”å› null æ—¶ä¸å½±å“å…¶ä»– Patch çš„æ³¨å†Œ

**æ•™è®­ï¼š**
- **ä¸€ä¸ª Patch çš„å¤±è´¥ä¸èƒ½å½±å“å…¶ä»– Patchï¼**
- **å¿…é¡»æ•è·æ‰€æœ‰å¼‚å¸¸ï¼Œç¡®ä¿ PatchAll ä¸ä¼šä¸­æ–­ï¼**

### é”™è¯¯4ï¼šé‡æ„å¯¼è‡´åŠŸèƒ½å›é€€
**é”™è¯¯è¡Œä¸ºï¼š**
- æŠŠèƒ½è·‘çš„ä»£ç æ”¹æˆäº†"æ›´ä¼˜é›…"çš„ç‰ˆæœ¬
- å¯¼è‡´è·¯ç”±å¤±æ•ˆã€å‡ºç”Ÿç‚¹ä¸ç”Ÿæ•ˆã€ç¼–è¯‘é”™è¯¯åå¤å‡ºç°
- æŠŠ `ApplySlaveEscapeNode5` ä»ç›´æ¥è°ƒç”¨æ”¹æˆäº†ä¾èµ– Pending æœºåˆ¶ï¼Œä½† Pending æœºåˆ¶æ˜¯ broken çš„

**æ•™è®­ï¼š**
- **ç¦æ­¢"ä¸ºäº†æ›´å¹²å‡€"é‡æ„ï¼**
- **æ—§ç‰ˆæœ¬æ€ä¹ˆåšä½ å°±æ€ä¹ˆåšï¼Œå…ˆæ¢å¤åŠŸèƒ½å†è°ˆä¼˜åŒ–ï¼**
- **ç¦æ­¢åˆ é™¤æ—§å®ç°ï¼Œé™¤éæ–°å®ç°å·²ç»ç”¨æ—¥å¿—è¯æ˜å®Œå…¨æ›¿ä»£å¹¶æ›´ç¨³å®šï¼**

### é”™è¯¯5ï¼šè¿‡æ—©æ¸…ç† PendingMenuSwitch
**é”™è¯¯è¡Œä¸ºï¼š**
- åœ¨ `OnNarrativeMenuOptionSelectedPatch.Postfix` ä¸­æ¸…ç©ºäº† `PendingMenuSwitch`
- å¯¼è‡´ `TrySwitchToNextMenuPatch` ä¸­çš„ `ResolveNextMenuId` è¯»å–ä¸åˆ°å®ƒ

**æ­£ç¡®åšæ³•ï¼š**
- `PendingMenuSwitch` åº”è¯¥ç”± `OriginMenuRouter.ResolveNextMenuId` æ¥ä½¿ç”¨å’Œæ¸…ç©º
- `OnNarrativeMenuOptionSelectedPatch.Postfix` åªè®°å½•çŠ¶æ€ï¼Œä¸æ¸…ç©º

**æ•™è®­ï¼š**
- **ç†è§£æ‰§è¡Œé¡ºåºï¼**
- **ä¸è¦åœ¨ä¸€ä¸ªåœ°æ–¹è®¾ç½®ï¼Œåœ¨å¦ä¸€ä¸ªåœ°æ–¹æ¸…ç©ºï¼**
- **æ•°æ®æµè¦æ¸…æ™°ï¼šOnSelect å†™å…¥ â†’ Router è¯»å–å¹¶æ¸…ç©º**

---

## ğŸ“š ç”¨æˆ·å’Œ ChatGPT çš„æ•™è‚²

### æ•™è‚²1ï¼šä¿å®ˆä¿®å¤åŸåˆ™
> "ä½ å…ˆåœæ‰‹ï¼Œä¸è¦ç»§ç»­é‡æ„ã€‚ç°åœ¨çš„ç‰ˆæœ¬"èƒ½ç¼–è¯‘ä½†åŠŸèƒ½ä¸ç”Ÿæ•ˆ"ï¼Œè€Œä»¥å‰çš„ç‰ˆæœ¬"èƒ½è·‘èƒ½å®ç°"ã€‚æ‰€ä»¥ä½ çš„å·¥ä½œæ¨¡å¼å¿…é¡»æ”¹æˆï¼šä»¥æ—§ç‰ˆæœ¬ä¸ºçœŸç›¸ï¼ˆground truthï¼‰ï¼Œåšå·®å¼‚å¯¹æ¯”ï¼ˆdiff-drivenï¼‰ï¼Œåªåšæœ€å°ä¿®å¤ï¼ˆsurgical fixï¼‰ï¼Œç”¨è¿è¡Œæ—¥å¿—è¯æ˜æ¢å¤ã€‚"

**å…³é”®ç‚¹ï¼š**
- ä»¥ old-good ç‰ˆæœ¬ä¸ºçœŸç›¸
- å·®å¼‚å¯¹æ¯”é©±åŠ¨ä¿®å¤
- æœ€å°åŒ–æ”¹åŠ¨
- ç”¨æ—¥å¿—è¯æ˜

### æ•™è‚²2ï¼šå¼ºåˆ¶æµç¨‹
> "ã€å¼ºåˆ¶æµç¨‹ï¼ˆå¿…é¡»æŒ‰é¡ºåºæ‰§è¡Œï¼Œä¸å…è®¸è·³æ­¥ï¼‰ã€‘
> 1) å…ˆå®šä½"æœ€åä¸€æ¬¡èƒ½å®ç°"çš„æäº¤/å¤‡ä»½ï¼ˆold-goodï¼‰ã€‚æŠŠ old-good çš„å…³é”®æ–‡ä»¶/é€»è¾‘å½“ä½œæ ‡å‡†ç­”æ¡ˆã€‚
> 2) å¯¹æ¯” old-good vs current-badï¼ˆé€æ–‡ä»¶ diffï¼‰ï¼Œåªæ‰¾"ä¸åŠŸèƒ½ä¸ç”Ÿæ•ˆç›´æ¥ç›¸å…³"çš„å·®å¼‚ï¼Œç¦æ­¢é¡ºæ‰‹æ•´ç†ä»£ç /é‡å‘½å/æŠ½è±¡å°è£…ã€‚
> 3) åˆ—å‡ºå·®å¼‚æ¸…å•ï¼ˆå¿…é¡»å†™å‡ºæ¥ï¼‰
> 4) åªä¿®å¤å·®å¼‚æ¸…å•é‡Œ"æœ€å¯èƒ½å¯¼è‡´ä¸ç”Ÿæ•ˆ"çš„ 1-3 ä¸ªç‚¹ï¼Œå…¶ä»–ä¸åŠ¨ã€‚æ¯ä¸ªç‚¹æ”¹åŠ¨å°½é‡ â‰¤ 20 è¡Œã€‚
> 5) ä¿®å¤åå¿…é¡»è‡ªè¯ï¼ˆæ²¡æœ‰æ—¥å¿—=æ²¡åšå®Œï¼‰"

**å…³é”®ç‚¹ï¼š**
- å¿…é¡»æŒ‰é¡ºåºæ‰§è¡Œ
- å¿…é¡»å†™å·®å¼‚æ¸…å•
- åªä¿®å¤ 1-3 ä¸ªå…³é”®ç‚¹
- æ¯ä¸ªç‚¹ â‰¤ 20 è¡Œ
- å¿…é¡»ç”¨æ—¥å¿—è‡ªè¯

### æ•™è‚²3ï¼šæ—¥å¿—å¿…é¡»æ˜¯å¯è¯ä¼ªçš„
> "ä½ è¿™ä»½æŠ¥å‘Šæœ€éœ€è¦æ”¹çš„ç‚¹ï¼ˆæŒ‰é‡è¦æ€§æ’åºï¼‰
> 1) "éªŒè¯é€šè¿‡"è¿™ä¸ªç»“è®ºä¸‹å¾—å¤ªæ—©
> ä½ ç°åœ¨éªŒè¯çš„æ˜¯ï¼š**ä»£ç é‡Œ"çœ‹èµ·æ¥"ä¼šæ‰§è¡Œ**ã€‚ä½†çœŸæ­£è¦éªŒè¯çš„æ˜¯ï¼š
> * Patch **åˆ°åº•æœ‰æ²¡æœ‰è¢«è°ƒç”¨**ï¼ˆç­¾åå¯¹ä¸å¯¹ / Harmony æ˜¯å¦ç”Ÿæ•ˆï¼‰
> * `PendingStartDirection` **æœ‰æ²¡æœ‰è¢« ResetState æ¸…æ‰**
> * `SetSlaveEscapeStartingLocation()` **åˆ°åº•æœ‰æ²¡æœ‰è¿”å› true**
> * `afterPos` **æœ‰æ²¡æœ‰åœ¨æ¥ä¸‹æ¥ N å¸§è¢«å¼•æ“è¦†ç›–å›é»˜è®¤å‡ºç”Ÿç‚¹**"

**å…³é”®ç‚¹ï¼š**
- ä¸è¦é™æ€èµ°è¯»ï¼Œè¦è¿è¡Œæ—¶éªŒè¯
- å¿…é¡»æä¾›çœŸå®è¿è¡Œæ—¥å¿—ç‰‡æ®µ
- å¿…é¡»æŒç»­ç›‘æµ‹ï¼ˆ10 tickï¼‰çœ‹æ˜¯å¦è¢«è¦†ç›–
- æ—¥å¿—å¿…é¡»æ‰“å°å…³é”®çŠ¶æ€å€¼

### æ•™è‚²4ï¼šä¸è¦è‡ªå—¨é‡æ„
> "ä½ åˆ«å†"é‡æ„ä¸Šå¤´"äº†ã€‚ä½ æ¯æ¬¡ refactor éƒ½æŠŠå·²å®ç°åŠŸèƒ½æ”¹å›å»ã€å¼•å…¥ç¼–è¯‘é”™è¯¯ã€æˆ–è€…æŠŠè·¯ç”±/èœå• ID æä¹±ã€‚æˆ‘ç°åœ¨è¦æ±‚ä½ æŒ‰"æ‰‹æœ¯å¼ä¿®æ”¹ + è‡ªæŸ¥åäº¤ä»˜"çš„æµç¨‹åšäº‹"

**å…³é”®ç‚¹ï¼š**
- ç¦æ­¢é‡æ„ä¸Šå¤´
- æ‰‹æœ¯å¼ä¿®æ”¹
- è‡ªæŸ¥åäº¤ä»˜

### æ•™è‚²5ï¼šæ—¥å¿—è·¯å¾„åœ¨ ProgramData
> "ä½ ä»–å¦ˆæ˜¯ä¸æ˜¯è„‘è¢‹å‚»äº† logsæ€ä¹ˆå¯èƒ½åœ¨dç›˜ æˆ‘æ“ä½ å¦ˆçš„åœ¨programdataå•Š ä½ ä¸ªå‚»é€¼"

**å…³é”®ç‚¹ï¼š**
- æ—¥å¿—åœ¨ `C:\ProgramData\Mount and Blade II Bannerlord\logs\`
- æ–‡ä»¶æ ¼å¼æ˜¯ `rgl_log_*.txt`
- ä¸è¦å‡è®¾ï¼Œè¦éªŒè¯ï¼

---

## ğŸš« ç¡¬æ€§ç¦æ­¢äº‹é¡¹

### ç¦æ­¢1ï¼šé‡æ„å’Œä¼˜åŒ–
- âŒ ç¦æ­¢"ä¸ºäº†æ›´å¹²å‡€"é‡æ„ã€é‡å‘½åã€æŠ½è±¡å…¬å…±æ–¹æ³•ã€æ¢ç›®å½•ã€æ”¹ menuId/optionId/stringId
- âŒ ç¦æ­¢"æˆ‘è§‰å¾—åº”è¯¥è¿™æ ·æ›´åˆç†"çš„æ”¹åŠ¨
- âŒ ç¦æ­¢åˆ é™¤æ—§å®ç°ï¼Œé™¤éæ–°å®ç°å·²ç»ç”¨æ—¥å¿—è¯æ˜å®Œå…¨æ›¿ä»£å¹¶æ›´ç¨³å®š

### ç¦æ­¢2ï¼šå¤§èŒƒå›´æ”¹åŠ¨
- âŒ ç¦æ­¢ä¸€æ¬¡æ”¹å¤šä¸ªæ–‡ä»¶ï¼ˆé™¤éæ˜ç¡®è¦æ±‚ï¼‰
- âŒ ç¦æ­¢æ”¹åŠ¨è¶…è¿‡ 20 è¡Œï¼ˆé™¤éæ˜ç¡®è¦æ±‚ï¼‰
- âŒ ç¦æ­¢æ”¹åŠ¨éç›®æ ‡æ–‡ä»¶

### ç¦æ­¢3ï¼šçŒœæµ‹å’Œå‡è®¾
- âŒ ç¦æ­¢è‡ªå·±ç¼–æ—¥å¿—å…³é”®è¯ï¼ˆå¿…é¡»ä»ä»£ç ä¸­æå–ï¼‰
- âŒ ç¦æ­¢å‡è®¾æ—¥å¿—è·¯å¾„ï¼ˆå¿…é¡»éªŒè¯ï¼‰
- âŒ ç¦æ­¢åªç»™ç†è®ºåˆ†æä¸è·‘æ—¥å¿—

### ç¦æ­¢4ï¼šç¼–è¯‘é”™è¯¯
- âŒ ç¦æ­¢å¼•å…¥æœªå¼•ç”¨çš„ç±»å‹ï¼ˆDebug / CultureObjectï¼‰
- âŒ ç¦æ­¢ç¼–è¯‘é”™è¯¯ï¼ˆ0 errors 0 warnings æ˜¯å¿…é¡»çš„ï¼‰
- âŒ ç¦æ­¢ä½¿ç”¨ä¸å­˜åœ¨çš„ APIï¼ˆå¿…é¡»å…ˆéªŒè¯ï¼‰

### ç¦æ­¢5ï¼šç ´åæ•°æ®æµ
- âŒ ç¦æ­¢åœ¨ä¸€ä¸ªåœ°æ–¹è®¾ç½®ï¼Œåœ¨å¦ä¸€ä¸ªåœ°æ–¹æ¸…ç©ºï¼ˆé™¤éæœ‰æ˜ç¡®ç†ç”±ï¼‰
- âŒ ç¦æ­¢è¿‡æ—©æ¸…ç†çŠ¶æ€å˜é‡ï¼ˆPendingMenuSwitchã€PendingStartDirectionï¼‰
- âŒ ç¦æ­¢ç ´åæ‰§è¡Œé¡ºåº

---

## âœ… å¿…é¡»éµå®ˆçš„æµç¨‹

### æµç¨‹1ï¼šå¼€å§‹å·¥ä½œå‰
1. **å®Œæ•´é˜…è¯»æ­¤æ–‡æ¡£**
2. **æ‰¾åˆ° old-good ç‰ˆæœ¬ä½œä¸ºæ ‡å‡†ç­”æ¡ˆ**
3. **ç†è§£å½“å‰é—®é¢˜å’Œç›®æ ‡**

### æµç¨‹2ï¼šä¿®å¤å‰
1. **å…ˆè¯»ç°æœ‰ä»£ç ï¼ˆä¸è¦æ”¹ï¼‰ï¼Œåˆ—å‡ºï¼š**
   - å½“å‰è·¯ç”±æ˜¯é ä»€ä¹ˆæœºåˆ¶ç”Ÿæ•ˆ
   - å…³é”® stringId / inputMenuId / outputMenuId çš„çº¦å®š
   - å…³é”®äº‹ä»¶æ—¶æœºï¼ˆFinalizeï¼ŸOnTickï¼ŸOnSessionLaunchedï¼Ÿï¼‰

2. **å…ˆåš"å¯¹ç…§å›å½’æ£€æŸ¥"ï¼š**
   - æ‰¾åˆ°"ä»¥å‰èƒ½å®ç°"çš„é‚£å¥—å…³é”®é€»è¾‘
   - å†™æ¸…æ¥š"ä»¥å‰ä¸ºä»€ä¹ˆèƒ½ç”Ÿæ•ˆ"ï¼Œç°åœ¨ä¸ºä»€ä¹ˆä¸ç”Ÿæ•ˆ
   - ä»»ä½•ä¿®å¤å¿…é¡»å°½é‡å¤ç”¨ä»¥å‰é‚£å¥—èƒ½å·¥ä½œçš„è·¯å¾„

3. **åˆ—å‡ºå·®å¼‚æ¸…å•ï¼ˆå¿…é¡»å†™å‡ºæ¥ï¼‰ï¼š**
   - å…³é”® menuId / optionId / route æ˜ å°„æ˜¯å¦å˜äº†
   - Harmony Patch çš„ç›®æ ‡æ–¹æ³•ç­¾åæ˜¯å¦å˜äº†
   - helper çš„ Pending/Selected æ˜¯å¦è¢« ResetState æå‰æ¸…ç©º
   - teleport/position è®¾ç½®æ—¶æœºæ˜¯å¦ä» old-good å˜æ—©/å˜æ™š

### æµç¨‹3ï¼šä¿®å¤æ—¶
1. **æ¯æ¬¡åªå…è®¸åšä¸€ä¸ªå°æ”¹åŠ¨ï¼š**
   - åªæ”¹ 1 ä¸ªæ–‡ä»¶æˆ– 1 ä¸ªå‡½æ•°
   - **å•æ¬¡ PR/æäº¤ â‰¤ 20 è¡ŒåŠŸèƒ½æ€§æ”¹åŠ¨ï¼ˆä¸å«çº¯æ—¥å¿—/æ³¨é‡Šï¼‰ï¼Œå¦åˆ™å¿…é¡»è¯´æ˜ç†ç”±**
   - æ”¹å®Œå¿…é¡»èƒ½ msbuild é€šè¿‡
   - ç»™å‡º git diff é£æ ¼çš„è¡¥ä¸

2. **ç¡®ä¿å¼‚å¸¸å¤„ç†ï¼š**
   - ä¸€ä¸ª Patch çš„å¤±è´¥ä¸èƒ½å½±å“å…¶ä»– Patch
   - å¿…é¡»æ•è·æ‰€æœ‰å¼‚å¸¸
   - è¿”å› null æ—¶ä¸å½±å“å…¶ä»–åŠŸèƒ½

### æµç¨‹4ï¼šä¿®å¤å
1. **è‡ªæŸ¥æ¸…å•ï¼ˆæ”¹å®Œå¿…é¡»è‡ªè¯ï¼‰ï¼š**
   - ç¼–è¯‘ï¼šmsbuild 0 errors 0 warnings
   - è·¯ç”±ï¼šç‚¹ä»»æ„é¢„è®¾å‡ºèº«æ—¶ï¼Œæ—¥å¿—å¿…é¡»å‡ºç°ï¼š
     - `Select: menu=xxx option=xxx`
     - `Switch: cur=xxx opt=xxx resolved=xxx`
     - `[Route] ä½¿ç”¨ PendingMenuSwitch: xxx`
     - `ForceSwitch: target=xxx found=True`
   - é€ƒå¥´å‡ºç”Ÿç‚¹ï¼šå¿…é¡»æœ‰æ—¥å¿—é“¾è¯æ˜ï¼š
     - Node5 é€‰æ‹©ä¿å­˜ direction
     - è®¾ç½®å‡ºç”Ÿä½ç½®å‡½æ•°ç¡®å®è¢«è°ƒç”¨
     - è®¾ç½®å‰åæ ‡/è®¾ç½®ååæ ‡/ä¸‹ä¸€å¸§åæ ‡
   - çŠ¶æ€ï¼šç¡®è®¤ ResetState ä¸ä¼šåœ¨è§’è‰²åˆ›å»ºæµç¨‹ä¸­æ¸…ç©º PendingStartDirection / PendingMenuSwitch

2. **è¾“å‡ºäº¤ä»˜å†…å®¹ï¼ˆå¿…é¡»åŒ…å«ï¼‰ï¼š**
   - æ”¹äº†å“ªäº›æ–‡ä»¶ + ä¿®æ”¹åŸå› ï¼ˆæ¯ä¸ªæ–‡ä»¶ä¸€å¥è¯ï¼‰
   - å…³é”® diff ç‰‡æ®µï¼ˆä¿®æ”¹å‰/åå„è´´ä¸€æ®µï¼‰
   - å¤ç°å®æµ‹æ­¥éª¤ï¼ˆç‚¹å“ªé‡Œé€‰ä»€ä¹ˆï¼‰
   - å®æµ‹æ—¥å¿—ç‰‡æ®µï¼ˆè¯æ˜è¡Œä¸ºæ¢å¤ï¼‰

---

## ğŸ›¡ï¸ PatchAll éš”ç¦»ç­–ç•¥æ¨¡æ¿ â­ æ–°å¢

### ç¡¬æ€§è§„åˆ™ï¼šä»»ä½• Patch çš„å¤±è´¥ä¸èƒ½å½±å“å…¶ä»– Patch

**æ¯ä¸ª Patch ç±»éƒ½å¿…é¡»éµå¾ªä»¥ä¸‹æ¨¡æ¿ï¼š**

```csharp
[HarmonyPatch]
public static class SomePatch
{
    // å¿…é¡»ä½¿ç”¨ SafeTargetMethodï¼Œä¸èƒ½ç›´æ¥ TargetMethod
    static MethodBase SafeTargetMethod()
    {
        try
        {
            var t = TargetType();
            if (t == null) return null;
            
            var method = AccessTools.Method(t, "MethodName");
            if (method == null)
            {
                OriginLog.Warning($"[SomePatch] TargetMethod è¿”å› nullï¼šMethodName ä¸å­˜åœ¨");
                return null; // ä¸ Patchã€ä¸ throw
            }
            
            return method;
        }
        catch (Exception ex)
        {
            OriginLog.Error($"[SomePatch] TargetMethod å¼‚å¸¸: {ex.Message}");
            return null; // ä¸ Patchã€ä¸ throw
        }
    }
    
    static MethodBase TargetMethod() => SafeTargetMethod(); // å§”æ‰˜ç»™å®‰å…¨ç‰ˆæœ¬
}
```

**PatchAll å¿…é¡»è¾“å‡ºåˆ†æ®µæ—¥å¿—ï¼š**

```csharp
protected override void OnSubModuleLoad()
{
    Debug.Print("[OriginSystem] PatchAll start", 0, Debug.DebugColor.Yellow);
    
    _harmony.PatchAll(typeof(OriginSystemPatches).Assembly);
    
    Debug.Print("[OriginSystem] PatchAll done", 0, Debug.DebugColor.Green);
    
    // æ£€æŸ¥å“ªäº› Patch è¢«è·³è¿‡ï¼ˆé€šè¿‡æ—¥å¿—ä¸­çš„ Warningï¼‰
    // æ—¥å¿—ä¸­åº”è¯¥èƒ½çœ‹åˆ°ï¼š
    // [SomePatch] TargetMethod è¿”å› nullï¼šMethodName ä¸å­˜åœ¨
    // â†’ è¯´æ˜è¿™ä¸ª Patch è¢«è·³è¿‡ï¼Œä½†ä¸å½±å“å…¶ä»– Patch
}
```

**ç¡¬æ€§è¦æ±‚ï¼š**
- âŒ **ç¦æ­¢åœ¨ static ctor / TargetMethod / Prepare é‡Œ throw**
- âŒ **ç¦æ­¢ä¸€ä¸ª Patch å¤±è´¥å¯¼è‡´æ•´ä¸ª PatchAll ä¸­æ–­**
- âœ… **æ¯ä¸ª Patch ç±»éƒ½å¿…é¡»æœ‰ SafeTargetMethod()ï¼štry-catchï¼Œå¤±è´¥è¿”å› null**
- âœ… **PatchAll å¿…é¡»è¾“å‡ºï¼šPatchAll start / PatchAll done / Patch skipped: <patchname> reason=<...>**

**è¿™æ ·ä½ ä»¥åçœ‹åˆ°æ—¥å¿—å°±èƒ½ä¸€çœ¼å®šä½"å“ªä¸ª patch è¢«è·³è¿‡ï¼Œè€Œä¸æ˜¯æ•´ä¸ªç³»ç»Ÿæ­»"ã€‚**

---

## ğŸ“ æ—¥å¿—å…³é”®è¯ç»Ÿä¸€ç®¡ç† â­ æ–°å¢

### ç¡¬æ€§è§„åˆ™ï¼šæ—¥å¿—ä¸è¦æ•£è½æˆæ‰‹å†™å­—ç¬¦ä¸²

**æ‰€æœ‰å…³é”®æ—¥å¿—å‰ç¼€å¿…é¡»ç»Ÿä¸€ä¸ºå¸¸é‡ï¼š**

```csharp
// åœ¨ OriginLog.cs æˆ–ç»Ÿä¸€å¸¸é‡æ–‡ä»¶ä¸­å®šä¹‰
public static class OriginLogPrefix
{
    public const string ROUTE = "[OS][Route]";
    public const string SELECT = "[OS][Select]";
    public const string SWITCH = "[OS][Switch]";
    public const string SLAVE_ESCAPE = "[OS][SlaveEscape]";
    public const string FINALIZE = "[OS][Finalize]";
    public const string TELEPORT = "[OS][Teleport]";
    public const string ERROR = "[OS][ERR]";
    public const string WARN = "[OS][WARN]";
}

// ä½¿ç”¨æ–¹å¼
OriginLog.Info($"{OriginLogPrefix.SELECT} menu={menuId} option={optionId}");
OriginLog.Info($"{OriginLogPrefix.SWITCH} cur={curMenuId} resolved={nextMenuId}");
```

**ç¡¬æ€§è¦æ±‚ï¼š**
- âŒ **ç¦æ­¢ç›´æ¥ `Debug.Print("xxx")` æ‰‹å†™å‰ç¼€**
- âŒ **ç¦æ­¢åœ¨ä»£ç ä¸­æ•£è½æ‰‹å†™æ—¥å¿—å­—ç¬¦ä¸²**
- âœ… **æ‰€æœ‰å…³é”®æ—¥å¿—å‰ç¼€å¿…é¡»å¤ç”¨å‰ç¼€å¸¸é‡**
- âœ… **æ–°å¢æ—¥å¿—å¿…é¡»ä½¿ç”¨ç»Ÿä¸€å‰ç¼€å¸¸é‡**

**è¿™æ ·ä½ çš„"æ’æŸ¥æ¸…å•"æ°¸è¿œä¸ä¼šè¿‡æœŸã€‚**

---

## ğŸ”— è·¯ç”±æ•°æ®ä¸å˜é‡æ£€æŸ¥ â­ æ–°å¢

### ç¡¬æ€§è§„åˆ™ï¼šè·¯ç”±å¿…é¡»æ»¡è¶³æ•°æ®ä¸å˜é‡

**è·¯ç”±ä¸å˜é‡ï¼ˆInvariantï¼‰ï¼š**

1. **PendingMenuSwitch ä¸å˜é‡ï¼š**
   - `PendingMenuSwitch` è®¾ç½®åï¼Œç›´åˆ° Router æ¶ˆè´¹å‰å¿…é¡»ä¿æŒéç©º
   - `PendingMenuSwitch` çš„å€¼å¿…é¡»ç­‰äºæŸä¸ªèœå•çš„ `InputMenuId`
   - ç¦æ­¢åœ¨ Router æ¶ˆè´¹å‰æ¸…ç©º `PendingMenuSwitch`

2. **èœå•æ³¨å†Œä¸å˜é‡ï¼š**
   - `NarrativeMenus` ä¸­ï¼š`InputMenuId` å¿…é¡»å”¯ä¸€æˆ–å¯é¢„æµ‹
   - å¦‚æœå¤šèœå•åŒ `InputMenuId`ï¼Œå¿…é¡»å†™æ¸…æ¥šé€‰æ‹©ç­–ç•¥
   - æ¯ä¸ªèœå•çš„ `StringId` å’Œ `InputMenuId` å¿…é¡»æ˜ç¡®å¯¹åº”å…³ç³»

3. **è·¯ç”±æ—¥å¿—ä¸å˜é‡ï¼š**
   - æ¯ä¸ªè·¯ç”±é€‰é¡¹å¿…é¡»èƒ½ä»æ—¥å¿—é‡Œæ‰“å°å‡ºï¼š
     - `curMenuId` / `optionId` / `pending` / `resolved` / `actualNext`
   - å¦‚æœ `resolved != actualNext`ï¼Œå¿…é¡»è®°å½•åŸå› 

**ç¡¬æ€§è¦æ±‚ï¼š**
- âŒ **ç¦æ­¢ `PendingMenuSwitch` åœ¨ Router æ¶ˆè´¹å‰è¢«æ¸…ç©º**
- âŒ **ç¦æ­¢ `InputMenuId` ä¸åŒ¹é…ä½†ç³»ç»Ÿé™é»˜å¤±è´¥**
- âœ… **æ¯ä¸ªè·¯ç”±å¿…é¡»æ‰“å°å®Œæ•´æ•°æ®æµï¼šcurMenuId â†’ optionId â†’ pending â†’ resolved â†’ actualNext**
- âœ… **å¦‚æœ `resolved != actualNext`ï¼Œå¿…é¡»è®°å½•åŸå› å¹¶ä¿®å¤**

**è¿™æ˜¯é˜²"èœå•å†™äº†ä½†å¼•æ“åŒ¹é…åˆ°å¦ä¸€ä¸ª"çš„æ ¸å¿ƒã€‚**

---

## ğŸ“Š è¿è¡Œæ—¶éªŒè¯æ ‡å‡† â­ æ–°å¢

### ç¡¬æ€§è§„åˆ™ï¼šè¿è¡Œæ—¶éªŒè¯å¿…é¡»åŒ…å«æŒç»­ç›‘æµ‹çª—å£

**å¯¹"ä½ç½®/çŠ¶æ€å¯èƒ½è¢«è¦†ç›–"çš„é—®é¢˜ï¼ŒéªŒè¯çª—å£å›ºå®šä¸ºï¼š**

```csharp
// æ ‡å‡†éªŒè¯æ¨¡æ¿
var pos_before = GetCurrentPosition();
SetPosition(targetPos);
var pos_after = GetCurrentPosition();

// æŒç»­ç›‘æµ‹ï¼šç¬¬ 1ã€3ã€10 tick çš„åæ ‡
var pos_t1 = WaitAndGetPosition(1);  // 1 tick å
var pos_t3 = WaitAndGetPosition(3);  // 3 tick å
var pos_t10 = WaitAndGetPosition(10); // 10 tick å

// è¾“å‡ºæ ¼å¼å›ºå®šä¸ºï¼š
OriginLog.Info($"[Teleport] pos_before=({pos_before.X:F2},{pos_before.Y:F2}) " +
               $"pos_after=({pos_after.X:F2},{pos_after.Y:F2}) " +
               $"pos_t1=({pos_t1.X:F2},{pos_t1.Y:F2}) " +
               $"pos_t3=({pos_t3.X:F2},{pos_t3.Y:F2}) " +
               $"pos_t10=({pos_t10.X:F2},{pos_t10.Y:F2})");

// åˆ¤å®šæ ‡å‡†ï¼š
if (pos_after != pos_t1)
{
    OriginLog.Error("[Teleport] å¼•æ“åœ¨ç¬¬ 1 tick è¦†å†™äº†ä½ç½®ï¼");
    // å¿…é¡»æ¢æ—¶æœºæˆ–æ¢ API
}
```

**ç¡¬æ€§è¦æ±‚ï¼š**
- âŒ **ç¦æ­¢åªæ‰“å°ä¸€è¡Œ `after` å°±åˆ¤å®šæˆåŠŸ**
- âŒ **ç¦æ­¢å‡è®¾"åº”è¯¥å¯ä»¥"è€Œä¸éªŒè¯**
- âœ… **å¿…é¡»ç›‘æµ‹ï¼šafter + ç¬¬ 1ã€3ã€10 tick çš„åæ ‡**
- âœ… **å¦‚æœ `pos_after != pos_t1` â†’ ç›´æ¥åˆ¤å®š"å¼•æ“è¦†å†™"ï¼Œå¿…é¡»æ¢æ—¶æœºæˆ–æ¢ API**

**è¿™æ¡ä¼šé€¼ç€å®ƒåœæ­¢"æˆ‘è§‰å¾—åº”è¯¥å¯ä»¥"ã€‚**

---

## ğŸ” API/ç±»å‹å¼•ç”¨è‡ªæŸ¥æ¸…å• â­ æ–°å¢

### ç¡¬æ€§è§„åˆ™ï¼šæ–°å¢ä»»ä½•ç±»å‹å‰å¿…é¡»å›ç­”ä»¥ä¸‹é—®é¢˜

**å¼•ç”¨è‡ªæŸ¥æ¸…å•ï¼ˆå¿…é¡»é€æ¡å›ç­”ï¼‰ï¼š**

1. **è¯¥ç±»å‹æ¥è‡ªå“ªä¸ª namespaceï¼Ÿ**
   - ä¾‹å¦‚ï¼š`Debug` â†’ `TaleWorlds.Library.Debug`
   - ä¾‹å¦‚ï¼š`CultureObject` â†’ `TaleWorlds.CampaignSystem.CultureObject`

2. **é¡¹ç›®æ˜¯å¦å·²å¼•ç”¨å¯¹åº” DLLï¼Ÿ**
   - æ£€æŸ¥ `OriginSystemMod.csproj` ä¸­çš„ `<Reference>` èŠ‚ç‚¹
   - æ£€æŸ¥ DLL æ˜¯å¦å­˜åœ¨äº `bin/Win64_Shipping_Client/` ç›®å½•

3. **æ˜¯å¦éœ€è¦ usingï¼Ÿ**
   - æ£€æŸ¥æ–‡ä»¶é¡¶éƒ¨æ˜¯å¦æœ‰å¯¹åº”çš„ `using` è¯­å¥
   - å¦‚æœæ²¡æœ‰ï¼Œå¿…é¡»æ·»åŠ 

4. **å¦‚æœä¸ç¡®å®šï¼Œç¦æ­¢å¼•å…¥è¯¥ç±»å‹**
   - å…ˆç”¨é¡¹ç›®ä¸­å·²å­˜åœ¨çš„æ—¥å¿—/ç±»å‹æ›¿ä»£
   - æˆ–è€…å…ˆéªŒè¯ç±»å‹æ˜¯å¦å­˜åœ¨ï¼ˆä½¿ç”¨åå°„æˆ–æŸ¥æ‰¾æ–‡æ¡£ï¼‰

**ç¡¬æ€§è¦æ±‚ï¼š**
- âŒ **ç¦æ­¢åœ¨ä¸ç¡®å®šçš„æƒ…å†µä¸‹å¼•å…¥æ–°ç±»å‹**
- âŒ **ç¦æ­¢ç›´æ¥ä½¿ç”¨ `Debug` è€Œä¸åŠ  `TaleWorlds.Library.` å‰ç¼€**
- âŒ **ç¦æ­¢å¼•å…¥æœªå¼•ç”¨çš„ç±»å‹ï¼ˆCS0246 / CS0103 é”™è¯¯ï¼‰**
- âœ… **æ–°å¢ä»»ä½•ç±»å‹å‰å¿…é¡»å›ç­”ä¸Šè¿° 4 ä¸ªé—®é¢˜**
- âœ… **å¦‚æœä¸ç¡®å®šï¼Œå…ˆç”¨é¡¹ç›®ä¸­å·²å­˜åœ¨çš„ç±»å‹æ›¿ä»£**

**è¿™ä¼šç›´æ¥é¿å…ä½ ä¹‹å‰é‚£ä¸€ä¸² CS0246 / CS0103 å¤ç°ã€‚**

---

## âŒ äº¤ä»˜å¤±è´¥æ¡ä»¶ â­ æ–°å¢

### ç¡¬æ€§è§„åˆ™ï¼šå‡ºç°ä»¥ä¸‹ä»»æ„ä¸€æ¡ = æœ¬æ¬¡äº¤ä»˜æ— æ•ˆï¼Œå¿…é¡»å›æ»šé‡åš

**äº¤ä»˜å¤±è´¥æ¡ä»¶æ¸…å•ï¼š**

1. **ç¼–è¯‘å¤±è´¥ï¼š**
   - âŒ ç¼–è¯‘é 0 errors / 0 warnings
   - âŒ å¼•å…¥æœªå¼•ç”¨çš„ç±»å‹ï¼ˆCS0246 / CS0103ï¼‰
   - âŒ ä½¿ç”¨ä¸å­˜åœ¨çš„ API

2. **æ—¥å¿—ç¼ºå¤±ï¼š**
   - âŒ å…³é”®æ—¥å¿—ç¼ºå¤±ï¼ˆSelect / Switch / Route / ForceSwitchï¼‰
   - âŒ æ—¥å¿—å…³é”®è¯ä¸åŒ¹é…ï¼ˆä½¿ç”¨äº†æ‰‹å†™å­—ç¬¦ä¸²è€Œéå¸¸é‡ï¼‰
   - âŒ æœªæä¾›çœŸå®è¿è¡Œæ—¥å¿—ç‰‡æ®µ

3. **æ”¹åŠ¨è¶…èŒƒå›´ï¼š**
   - âŒ æ”¹åŠ¨è¶…è¿‡èŒƒå›´ä¸”æ— ç†ç”±ï¼ˆå•æ¬¡æ”¹åŠ¨ > 20 è¡ŒåŠŸèƒ½æ€§ä»£ç ä¸”æœªè¯´æ˜ï¼‰
   - âŒ æ”¹åŠ¨äº†éç›®æ ‡æ–‡ä»¶
   - âŒ é‡æ„äº†éç›®æ ‡ä»£ç 

4. **æœªæä¾›å¿…è¦ä¿¡æ¯ï¼š**
   - âŒ æœªæä¾› diffï¼ˆä¿®æ”¹å‰/åå¯¹æ¯”ï¼‰
   - âŒ æœªæä¾›å¤ç°å®æµ‹æ­¥éª¤
   - âŒ æœªæä¾›å®æµ‹æ—¥å¿—ç‰‡æ®µ

5. **åŠŸèƒ½æœªæ¢å¤ï¼š**
   - âŒ è·¯ç”±ä»ç„¶å¤±æ•ˆ
   - âŒ å‡ºç”Ÿä½ç½®ä»ç„¶ä¸ç”Ÿæ•ˆ
   - âŒ å…³é”®åŠŸèƒ½æœªæ¢å¤

**ç¡¬æ€§è¦æ±‚ï¼š**
- âŒ **å‡ºç°ä»¥ä¸Šä»»æ„ä¸€æ¡ = æœ¬æ¬¡äº¤ä»˜æ— æ•ˆ**
- âœ… **å¿…é¡»å›æ»šåˆ° old-good ç‰ˆæœ¬é‡åš**
- âœ… **å¿…é¡»è¯´æ˜å¤±è´¥åŸå› å¹¶ä¿®æ­£**

---

## ğŸ“‹ æ ‡å‡†éªŒè¯æ¨¡æ¿ â­ æ–°å¢

### è·¯ç”±/å‡ºç”Ÿç‚¹ç±»é—®é¢˜çš„æ ‡å‡†éªŒè¯æ¨¡æ¿

**å½•åˆ¶ä¸€æ®µæœ€çŸ­å¤ç°è·¯å¾„ï¼š**
```
ç‚¹å‡»é¡ºåºï¼šèœå•A â†’ é€‰é¡¹X â†’ èœå•B
```

**æä¾›æ—¥å¿—ç‰‡æ®µå¿…é¡»åŒ…å«ï¼š**

1. **Selectï¼ˆç¡®è®¤ OnSelect è§¦å‘ï¼‰ï¼š**
   ```
   [OS][Select] menu=origin_type_selection option=preset_origin_option
   ```

2. **Switchï¼ˆç¡®è®¤ TrySwitchToNextMenu è¢«è°ƒç”¨ï¼‰ï¼š**
   ```
   [OS][Switch] cur=origin_type_selection opt=preset_origin_option resolved=preset_origin_selection
   ```

3. **Route/Resolveï¼ˆç¡®è®¤ pending è¢«æ¶ˆè´¹ï¼‰ï¼š**
   ```
   [OS][Route] ä½¿ç”¨ PendingMenuSwitch: preset_origin_selection
   ```

4. **ForceSwitchï¼ˆç¡®è®¤ç›®æ ‡èœå•å­˜åœ¨å¹¶åˆ‡æ¢ï¼‰ï¼š**
   ```
   [OS][Switch] ForceSwitch: target=preset_origin_selection found=True setCurrent=True
   ```

**å¯¹ä½ç½®ç±»é—®é¢˜ï¼Œå¿…é¡»é™„å¸¦ï¼š**

```
[OS][Teleport] pos_before=(100.00,200.00) 
              pos_after=(150.00,250.00) 
              pos_t1=(150.00,250.00) 
              pos_t3=(150.00,250.00) 
              pos_t10=(150.00,250.00)
```

**è‹¥è¦†å†™å‘ç”Ÿï¼Œå¿…é¡»ç»™å‡º"å“ªä¸ªäº‹ä»¶ä¹‹åè¢«è¦†å†™"çš„è¯æ®ï¼š**
```
[OS][Teleport] pos_after=(150.00,250.00) 
              pos_t1=(100.00,200.00) â† å¼•æ“åœ¨ç¬¬ 1 tick è¦†å†™
              pos_t3=(100.00,200.00)
              pos_t10=(100.00,200.00)
```

**ç¡¬æ€§è¦æ±‚ï¼š**
- âŒ **ç¦æ­¢åªæä¾›ç†è®ºåˆ†æï¼Œä¸æä¾›æ—¥å¿—**
- âŒ **ç¦æ­¢åªæä¾›éƒ¨åˆ†æ—¥å¿—ï¼Œç¼ºå°‘å…³é”®æ­¥éª¤**
- âœ… **å¿…é¡»æä¾›å®Œæ•´æ—¥å¿—é“¾ï¼šSelect â†’ Switch â†’ Route â†’ ForceSwitch**
- âœ… **ä½ç½®ç±»é—®é¢˜å¿…é¡»æä¾›ï¼šbefore / after / t1 / t3 / t10**

---

## ğŸ“ æ—¥å¿—è·¯å¾„å’ŒæŸ¥æ‰¾æ–¹æ³•

### æ­£ç¡®æ—¥å¿—è·¯å¾„
```
C:\ProgramData\Mount and Blade II Bannerlord\logs\
```

### æ—¥å¿—æ–‡ä»¶æ ¼å¼
- æ–‡ä»¶åï¼š`rgl_log_*.txt`ï¼ˆä¸æ˜¯ `.log`ï¼‰
- æœ€æ–°æ–‡ä»¶ï¼šæŒ‰ `LastWriteTime` æ’åºï¼Œå–ç¬¬ä¸€ä¸ª

### æŸ¥æ‰¾æ–¹æ³•
```powershell
# æ–¹æ³•1ï¼šä½¿ç”¨è„šæœ¬
cd "D:\SteamLibrary\steamapps\common\Mount & Blade II Bannerlord\Modules\OriginSystemMod"
.\æŸ¥æ‰¾æ—¥å¿—.ps1

# æ–¹æ³•2ï¼šæ‰‹åŠ¨æŸ¥æ‰¾
$logPath = "C:\ProgramData\Mount and Blade II Bannerlord\logs"
$latest = Get-ChildItem $logPath -Filter "rgl_log_*.txt" | Sort-Object LastWriteTime -Descending | Select-Object -First 1
Get-Content $latest.FullName | Select-String -Pattern "OriginSystem|OS\]|Select:|Switch:"
```

### å…³é”®æ—¥å¿—å…³é”®è¯ï¼ˆä»å®é™…ä»£ç ä¸­æå–ï¼‰
- `[OriginSystem] DLL åŠ è½½ä¿¡æ¯` - DLL åŠ è½½
- `[OriginSystem] Harmony PatchAll å®Œæˆ` - Patch æ³¨å†ŒæˆåŠŸ
- `Select: menu=` - é€‰é¡¹é€‰æ‹©
- `Postfix: å½“å‰èœå• =` - Postfix æ‰§è¡Œ
- `Switch: cur=` - èœå•åˆ‡æ¢
- `[Route] ä½¿ç”¨ PendingMenuSwitch:` - è·¯ç”±è§£æ
- `ForceSwitch: target=` - å¼ºåˆ¶åˆ‡æ¢ç»“æœ
- `[SlaveEscape][Node5] å·²ä¿å­˜æœŸæœ›å‡ºç”Ÿä½ç½®:` - Node5 é€‰æ‹©
- `[SlaveEscape][Finalize] OnCharacterCreationFinalized Postfix called` - Finalize è§¦å‘
- `[SlaveEscape][Teleport] success=` - ä½ç½®è®¾ç½®ç»“æœ

---

## ğŸ¯ æ€»ç»“ï¼šæ¯æ¬¡å¼€å§‹å·¥ä½œå‰å¿…é¡»é—®è‡ªå·±

### åŸºç¡€æ£€æŸ¥ï¼ˆå¿…é¡»å…¨éƒ¨é€šè¿‡ï¼‰
1. âœ… æˆ‘å®Œæ•´é˜…è¯»äº†å¿…è¯»æ–‡æ¡£å—ï¼Ÿ
2. âœ… æˆ‘è®°å½•äº† current-bad å’Œ old-good çš„ commit hash å—ï¼Ÿ
3. âœ… æˆ‘ç¡®ä¿æœ‰å¯å›æ»šç‚¹ï¼ˆgit tag æˆ– commit hashï¼‰å—ï¼Ÿ
4. âœ… æˆ‘æ‰¾åˆ°äº† old-good ç‰ˆæœ¬ä½œä¸ºæ ‡å‡†ç­”æ¡ˆå—ï¼Ÿ

### ä¿®å¤å‰æ£€æŸ¥ï¼ˆå¿…é¡»å…¨éƒ¨é€šè¿‡ï¼‰
5. âœ… æˆ‘åšäº†å·®å¼‚å¯¹æ¯”å¹¶åˆ—å‡ºå·®å¼‚æ¸…å•äº†å—ï¼Ÿ
6. âœ… æˆ‘å›ç­”äº† API/ç±»å‹å¼•ç”¨è‡ªæŸ¥æ¸…å•çš„ 4 ä¸ªé—®é¢˜å—ï¼Ÿ
7. âœ… æˆ‘ç¡®è®¤äº†è·¯ç”±æ•°æ®ä¸å˜é‡å—ï¼Ÿ

### ä¿®å¤æ—¶æ£€æŸ¥ï¼ˆå¿…é¡»å…¨éƒ¨é€šè¿‡ï¼‰
8. âœ… æˆ‘çš„æ”¹åŠ¨æ˜¯æœ€å°åŒ–çš„å—ï¼ˆâ‰¤ 20 è¡ŒåŠŸèƒ½æ€§ä»£ç ï¼Œä¸å«æ—¥å¿—/æ³¨é‡Šï¼‰ï¼Ÿ
9. âœ… æˆ‘ç¡®ä¿äº†ä¸€ä¸ª Patch çš„å¤±è´¥ä¸å½±å“å…¶ä»– Patch å—ï¼ˆä½¿ç”¨ SafeTargetMethodï¼‰ï¼Ÿ
10. âœ… æˆ‘ä½¿ç”¨äº†ç»Ÿä¸€çš„æ—¥å¿—å‰ç¼€å¸¸é‡å—ï¼ˆä¸æ˜¯æ‰‹å†™å­—ç¬¦ä¸²ï¼‰ï¼Ÿ

### ä¿®å¤åæ£€æŸ¥ï¼ˆå¿…é¡»å…¨éƒ¨é€šè¿‡ï¼‰
11. âœ… æˆ‘æ·»åŠ äº†è¶³å¤Ÿçš„æ—¥å¿—æ¥è¯æ˜åŠŸèƒ½æ¢å¤å—ï¼Ÿ
12. âœ… æˆ‘æä¾›äº†å®Œæ•´æ—¥å¿—é“¾å—ï¼ˆSelect â†’ Switch â†’ Route â†’ ForceSwitchï¼‰ï¼Ÿ
13. âœ… ä½ç½®ç±»é—®é¢˜æˆ‘æä¾›äº† before / after / t1 / t3 / t10 å—ï¼Ÿ
14. âœ… æˆ‘ç¡®ä¿ç¼–è¯‘é€šè¿‡äº†å—ï¼ˆ0 errors 0 warningsï¼‰ï¼Ÿ
15. âœ… æˆ‘æä¾›äº†å¯æ‰§è¡Œçš„æµ‹è¯•æ­¥éª¤å’Œé¢„æœŸæ—¥å¿—å—ï¼Ÿ
16. âœ… æˆ‘é¿å…äº†æ‰€æœ‰ç¦æ­¢äº‹é¡¹å—ï¼Ÿ
17. âœ… æˆ‘ç¡®è®¤æ²¡æœ‰è§¦å‘ä»»ä½•"äº¤ä»˜å¤±è´¥æ¡ä»¶"å—ï¼Ÿ

**å¦‚æœä»¥ä¸Šä»»ä½•ä¸€æ¡ç­”æ¡ˆæ˜¯"å¦"ï¼Œä¸è¦ç»§ç»­ï¼Œå…ˆå®Œæˆå®ƒï¼**

**å‡ºç°ä»¥ä¸‹ä»»æ„ä¸€æ¡ = æœ¬æ¬¡äº¤ä»˜æ— æ•ˆï¼Œå¿…é¡»å›æ»šé‡åšï¼š**
- ç¼–è¯‘é 0/0
- å…³é”®æ—¥å¿—ç¼ºå¤±
- æœªæä¾› diff
- æ”¹åŠ¨è¶…è¿‡èŒƒå›´ä¸”æ— ç†ç”±

---

## ğŸ“ æœ€åæé†’

**è®°ä½ï¼š**
- ç”¨æˆ·å’Œ ChatGPT çš„æ•™è‚²æ˜¯åŸºäºçœŸå®ç—›è‹¦çš„æ•™è®­
- æ¯æ¬¡è¿åè¿™äº›è§„åˆ™ï¼Œéƒ½ä¼šå¯¼è‡´åŠŸèƒ½å›é€€ã€ç¼–è¯‘é”™è¯¯ã€æˆ–æµªè´¹æ—¶é—´
- ä¿å®ˆä¿®å¤ > ä¼˜é›…é‡æ„
- æ—¥å¿—è¯æ˜ > ç†è®ºåˆ†æ
- æœ€å°æ”¹åŠ¨ > å¤§èŒƒå›´é‡æ„

**ä¸è¦é‡è¹ˆè¦†è¾™ï¼**

---

*æœ€åæ›´æ–°ï¼š2025-12-24*
*åŸºäºçœŸå®é”™è¯¯æ•™è®­å’Œç”¨æˆ·/ChatGPT æ•™è‚²æ•´ç†*

