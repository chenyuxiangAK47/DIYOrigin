# 非预设出身系统实现计划

## 已完成

1. ✅ **NonPresetOriginSystem.cs** - 非预设出身效果应用逻辑
2. ✅ **OriginSystemHelper.cs** - 添加SelectedNonPresetOriginNodes字典
3. ✅ **OriginSystemCampaignBehavior.cs** - 调用NonPresetOriginSystem.ApplyNonPresetOrigin()

## 待实现

### 1. 菜单创建方法（OriginSystemPatches.cs）

需要重写以下方法：

#### 公共节点（必需）
- [ ] `CreateNonPresetSocialOriginMenu` - 社会出身菜单（7个选项）
- [ ] `CreateNonPresetSkillBackgroundMenu` - 技能背景菜单（8个选项）
- [ ] `CreateNonPresetStartingConditionMenu` - 当前状态菜单（6个选项）

#### 可选公共节点
- [ ] `CreateNonPresetLocationTypeMenu` - 起始位置类型菜单（4个选项）
- [ ] `CreateNonPresetValuableItemMenu` - 贵重物品菜单（4个选项）
- [ ] `CreateNonPresetContactTypeMenu` - 联系人类型菜单（4个选项）

#### 私有节点（根据社会出身触发）
- [ ] `CreateNonPresetNomadRoleMenu` - 游牧营地角色菜单（4个选项，需social_origin_nomad_camp）
- [ ] `CreateNonPresetArtisanTradeMenu` - 手工业者手艺菜单（4个选项，需social_origin_urban_artisan）
- [ ] `CreateNonPresetCaravanDutyMenu` - 商队职责菜单（4个选项，需social_origin_caravan_follower）
- [ ] `CreateNonPresetMinorClanPositionMenu` - 小氏族位置菜单（4个选项，需social_origin_minor_clan）
- [ ] `CreateNonPresetRefugeeBurdenMenu` - 流浪难民负担菜单（4个选项，需social_origin_wanderer）

### 2. OnSelect回调方法

需要为每个选项创建OnSelect回调，将选择存储到`OriginSystemHelper.SelectedNonPresetOriginNodes`。

### 3. 路由逻辑（TrySwitchToNextMenuPatch）

需要更新路由逻辑，确保：
- 社会出身 → 技能背景（或私有节点，如果适用）
- 技能背景 → 当前状态
- 当前状态 → 可选节点（或结束）
- 私有节点在正确时机出现

## 实现顺序

1. 先实现公共3步：social_origin -> skill_background -> starting_condition
2. 然后添加可选节点：location_type, valuable_item, contact_type
3. 最后添加私有节点：nomad_role, artisan_trade, caravan_duty, minor_clan_position, refugee_burden

## 注意事项

- 所有选项ID必须与配置文件中的ID完全匹配
- OnSelect回调必须将选择存储到SelectedNonPresetOriginNodes
- 私有节点必须检查requires条件
- 所有菜单的InputMenuId和OutputMenuId必须正确设置























































