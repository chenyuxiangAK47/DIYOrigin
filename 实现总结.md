# OriginSystemMod å®ç°æ€»ç»“

## âœ… å·²å®Œæˆ

### 1. åŸºç¡€ç»“æ„
- âœ… `SubModule.xml` - Mod é…ç½®
- âœ… `OriginSystemMod.csproj` - é¡¹ç›®æ–‡ä»¶ï¼ˆx64 å¹³å°ï¼‰
- âœ… `OriginSystemHelper.cs` - å…¨å±€è¾…åŠ©ç±»ï¼ˆå‡ºèº«ç±»å‹ã€é¢„è®¾å‡ºèº« IDã€éé¢„è®¾å‡ºèº«æ•°æ®ï¼‰
- âœ… `OriginSystemSubModule.cs` - ä¸»å…¥å£ï¼ˆHarmony åˆå§‹åŒ–ã€CampaignBehavior æ³¨å†Œï¼‰
- âœ… `OriginSystemCampaignBehavior.cs` - CampaignBehaviorï¼ˆåœ¨ OnSessionLaunched åº”ç”¨é¢„è®¾å‡ºèº«æ•ˆæœï¼‰

### 2. Harmony Patch å®ç°
- âœ… `OriginSystemPatches.cs` - å®ç°äº† `AddParentsMenu` çš„ Postfix Patch
  - åˆ›å»º"å‡ºèº«ç±»å‹é€‰æ‹©"èœå•ï¼ˆInputMenuId = "start"ï¼‰
  - åˆ é™¤åŸçˆ¶æ¯èœå•ï¼Œé‡æ–°åˆ›å»ºï¼ˆä¿®æ”¹ InputMenuIdï¼‰
  - æ·»åŠ "é¢„è®¾å‡ºèº«"å’Œ"éé¢„è®¾å‡ºèº«"ä¸¤ä¸ªé€‰é¡¹

## ğŸ“‹ ä»£ç æ£€æŸ¥ç»“æœ

### âœ… æ­£ç¡®çš„éƒ¨åˆ†
1. **å‘½åç©ºé—´å’Œå¼•ç”¨** - æ­£ç¡®
2. **Harmony Patch ç»“æ„** - æ­£ç¡®ï¼ˆä½¿ç”¨ Postfixï¼‰
3. **èœå•åˆ›å»ºé€»è¾‘** - åŸºæœ¬æ­£ç¡®
4. **ç±»å‹ä½¿ç”¨** - æ­£ç¡®ï¼ˆNarrativeMenu, NarrativeMenuOption, CharacterCreationManagerï¼‰

### âš ï¸ éœ€è¦æ³¨æ„çš„é—®é¢˜

1. **èœå•é“¾è¿æ¥**
   - å½“å‰ï¼šé€‰æ‹©"é¢„è®¾å‡ºèº«"æˆ–"éé¢„è®¾å‡ºèº«"åï¼Œéƒ½åˆ‡æ¢åˆ°ä¸‹ä¸€ä¸ªèœå•ï¼ˆçˆ¶æ¯èœå•ï¼‰
   - åº”è¯¥ï¼šé€‰æ‹©"é¢„è®¾å‡ºèº«" â†’ è¿›å…¥é¢„è®¾å‡ºèº«é€‰æ‹©èœå•ï¼›é€‰æ‹©"éé¢„è®¾å‡ºèº«" â†’ è¿›å…¥éé¢„è®¾å‡ºèº«ä¸‰æ­¥é€‰æ‹©

2. **é¢„è®¾å‡ºèº«é€‰æ‹©èœå•**
   - éœ€è¦åˆ›å»ºé¢„è®¾å‡ºèº«é€‰æ‹©èœå•ï¼ˆè‰åŸå›é…‹ã€è¿å¾™ç‹æ—ã€æˆ˜å¥´é€ƒäº¡ç­‰ï¼‰
   - èœå•é“¾ï¼š`origin_type_selection` â†’ `preset_origin_selection` â†’ `narrative_parent_menu`

3. **éé¢„è®¾å‡ºèº«é€‰æ‹©èœå•**
   - éœ€è¦åˆ›å»ºéé¢„è®¾å‡ºèº«ä¸‰æ­¥é€‰æ‹©èœå•
   - èœå•é“¾ï¼š`origin_type_selection` â†’ `culture_anchor_selection` â†’ `social_origin_selection` â†’ `skill_background_selection` â†’ `starting_condition_selection` â†’ `narrative_parent_menu`

4. **RecreateParentMenuWithNewInputId æ–¹æ³•**
   - ä½¿ç”¨åå°„è·å–åŸèœå•é€‰é¡¹
   - å¦‚æœåå°„å¤±è´¥ï¼Œè¿”å›ç©ºèœå•ï¼ˆå¯èƒ½ä¸¢å¤±åŸé€‰é¡¹ï¼‰

## ğŸ” åç¼–è¯‘ä»£ç åˆ†æ

### NarrativeMenu ç»“æ„
```csharp
public NarrativeMenu(
    string stringId,           // èœå• ID
    string inputMenuId,        // å‰ä¸€ä¸ªèœå•çš„ StringIdï¼ˆ"start" è¡¨ç¤ºç¬¬ä¸€ä¸ªèœå•ï¼‰
    string outputMenuId,       // ä¸‹ä¸€ä¸ªèœå•çš„ StringId
    TextObject title,          // æ ‡é¢˜
    TextObject description,    // æè¿°
    List<NarrativeMenuCharacter> characters,  // è§’è‰²åˆ—è¡¨
    GetNarrativeMenuCharacterArgsDelegate getNarrativeMenuCharacterArgs  // å§”æ‰˜æ–¹æ³•
);
```

### NarrativeMenuOption ç»“æ„
```csharp
public NarrativeMenuOption(
    string stringId,                                    // é€‰é¡¹ ID
    TextObject text,                                    // é€‰é¡¹æ–‡æœ¬
    TextObject descriptionText,                         // é€‰é¡¹æè¿°
    GetNarrativeMenuOptionArgsDelegate getNarrativeMenuOptionArgs,  // è®¾ç½® Args
    NarrativeMenuOptionOnConditionDelegate onCondition,              // æ¡ä»¶æ£€æŸ¥
    NarrativeMenuOptionOnSelectDelegate onSelect,                    // é€‰æ‹©å›è°ƒ
    NarrativeMenuOptionOnConsequenceDelegate onConsequence           // åæœå›è°ƒï¼ˆå¯é€‰ï¼‰
);
```

### å…³é”®æ–¹æ³•
- `CharacterCreationManager.AddNewMenu(NarrativeMenu menu)` - æ·»åŠ èœå•
- `CharacterCreationManager.StartNarrativeStage()` - å¯åŠ¨å™äº‹é˜¶æ®µï¼ŒæŸ¥æ‰¾ InputMenuId == "start" çš„èœå•
- `CharacterCreationManager.TrySwitchToNextMenu()` - åˆ‡æ¢åˆ°ä¸‹ä¸€ä¸ªèœå•ï¼ˆæ ¹æ® OutputMenuIdï¼‰
- `CharacterCreationManager.OnNarrativeMenuOptionSelected(NarrativeMenuOption option)` - é€‰æ‹©é€‰é¡¹

## ğŸš€ ä¸‹ä¸€æ­¥å®ç°

### MVPï¼ˆæœ€å°å¯è¡Œç‰ˆæœ¬ï¼‰
1. âœ… åˆ›å»º"å‡ºèº«ç±»å‹é€‰æ‹©"èœå•ï¼ˆå·²å®Œæˆï¼‰
2. â³ åˆ›å»ºé¢„è®¾å‡ºèº«é€‰æ‹©èœå•ï¼ˆè‰åŸå›é…‹ã€è¿å¾™ç‹æ—ã€æˆ˜å¥´é€ƒäº¡ï¼‰
3. â³ åˆ›å»ºéé¢„è®¾å‡ºèº«ä¸‰æ­¥é€‰æ‹©èœå•ï¼ˆæ–‡åŒ–é”šç‚¹ã€ç¤¾ä¼šå‡ºèº«ã€æŠ€èƒ½æ¥æºã€å½“å‰çŠ¶æ€ï¼‰
4. â³ å®ç°èœå•é“¾æ­£ç¡®è¿æ¥
5. â³ å®ç°é¢„è®¾å‡ºèº«æ•ˆæœåº”ç”¨ï¼ˆåœ¨ OnSessionLaunched ä¸­ï¼‰

### æµ‹è¯•è¦ç‚¹
1. èœå•æ˜¯å¦æ­£å¸¸æ˜¾ç¤º
2. èœå•é“¾æ˜¯å¦æ­£ç¡®è¿æ¥
3. é€‰æ‹©é€‰é¡¹åæ˜¯å¦æ­£ç¡®åˆ‡æ¢
4. é¢„è®¾å‡ºèº«æ•ˆæœæ˜¯å¦æ­£ç¡®åº”ç”¨

## ğŸ“ ä»£ç è´¨é‡

- âœ… éµå¾ª ChatGPT æ•™è¯²ï¼šåª patch ç¡®å®šå­˜åœ¨çš„æ–¹æ³•
- âœ… è¯¦ç»†çš„æ—¥å¿—è¾“å‡º
- âœ… å¼‚å¸¸å¤„ç†å®Œå–„
- âœ… ä»£ç ç»“æ„æ¸…æ™°

## âš ï¸ æ½œåœ¨é—®é¢˜

1. **åå°„è·å–èœå•é€‰é¡¹**ï¼šå¦‚æœåŸèœå•ç»“æ„å˜åŒ–ï¼Œå¯èƒ½å¤±è´¥
2. **èœå•é“¾è¿æ¥**ï¼šéœ€è¦ç¡®ä¿æ‰€æœ‰èœå•çš„ InputMenuId å’Œ OutputMenuId æ­£ç¡®
3. **è§’è‰²åˆ›å»ºé˜¶æ®µ**ï¼šéé¢„è®¾å‡ºèº«çš„æ•ˆæœéœ€è¦åœ¨è§’è‰²åˆ›å»ºé˜¶æ®µé€æ­¥åº”ç”¨ï¼Œè€Œä¸æ˜¯åœ¨ OnSessionLaunched


























































