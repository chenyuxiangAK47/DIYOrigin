# 给 Cursor 的硬性开发指令（直接复制使用）

## 直接发给 Cursor 的话（强硬版）

**你不要再"脑补重写"我的文件。** 你现在的输出把 `OriginSystemPatches.cs` 搞出了大量 **CS1010 常量中有换行符** 和 **CS1056 意外字符**（中文标点/乱码），属于编码/字符串闭合错误，导致后面全部连锁报错。

**别写小说，先让它能编译；别猜字段名，先对照原版；别动一整坨，先提交最小 diff。**

## 硬性要求

### 1. 工作流程（必须遵守）

- ✅ **先恢复文件到最近一次能编译的 commit**（或把坏文件丢掉重新从原版拷贝再改）
- ✅ **每次改动不超过一个功能点**：
  - 先修编码/字符串 → **编译通过**
  - 再修菜单链路 → **编译通过**
  - 再修 Harmony Patch 时序 → **编译通过**
- ✅ **每次输出前自检**：
  - 搜索 `new TextObject("` 是否都成对闭合
  - 搜索 `#region` 是否都有 `#endregion`
  - 检查是否出现 ``、全角逗号 `，`、顿号 `、`、中文句号 `。` 在 C# 语法位置

### 2. 编码与字符串硬规则

- ✅ `OriginSystemPatches.cs` 统一保存为 **UTF-8**
- ✅ **禁止**在字符串中使用裸换行符（这就是 CS1010 的根源）
  - ❌ `new TextObject("第一行\n第二行")` （裸换行）
  - ✅ `new TextObject("第一行\\n第二行")` （转义换行）
  - ✅ `new TextObject(@"第一行
第二行")` （逐字字符串）
- ✅ 所有中文只能出现在：
  - `TextObject` 字符串里（且引号完整）
  - 注释里（不允许注释断到字符串中间）
- ✅ **禁止**在代码中写入：
  - 乱码替换符 ``
  - 花引号 `"` `"`
  - 全角标点 `，` `。` `、` `：` `×` 在语法位置

### 3. 最重要：不要瞎改引擎状态机

- ✅ **禁止**用反射去 set `CurrentMenu`（你之前已经证明会失败/不稳定）
- ✅ 菜单切换要通过 **唯一 InputMenuId / OutputMenuId 链路**让引擎自动走
- ✅ `OnSelect` 里只做"设置标志/写数据"，不要再直接调用 `TrySwitchToNextMenu()` 抢时序

### 4. 输出格式要求

- ✅ **只给我一个 git patch**（或明确列出改动的行号+替换内容）
- ✅ **不要贴整文件**，不要解释大道理
- ✅ **每次只做最小 diff**：一次只改一个函数/一个 patch 点
- ✅ **改完必须本地 msbuild 通过再继续**

## 你现在立刻做的任务（按优先级）

### 优先级1：修复编译错误（让项目能编译）

1. **定位第一个 CS1010 错误**（通常是第 3553 行附近）
   - 找到那个字符串，把裸换行改成 `\\n` 或使用 `@"..."` 逐字字符串
   - **只修这一个，编译验证，再继续下一个**

2. **清理致命字符**
   - 搜索并删除所有 ``（乱码替换符）
   - 搜索并替换所有花引号 `"` `"` → `"`
   - 搜索并修复语法位置的全角标点

3. **修复字符串闭合**
   - 确保所有 `new TextObject("` 都有对应的 `")`
   - 确保所有字符串引号成对

4. **修复结构错误**（最后才做）
   - 修复缺失的 `}` 和 `#endregion`
   - 这些往往是第一个字符串炸了以后的连锁反应

### 优先级2：验证修复

- 每修复一个错误，运行 `msbuild` 验证
- 错误数应该快速下降（因为很多是连锁反应）
- 如果修复后错误数没降，说明你修错了位置

### 优先级3：功能修复（编译通过后再做）

- 修复菜单链路（每条预设出身 Node1 的 InputMenuId 必须唯一）
- 修复 Patch 时序

## 禁止事项

1. ❌ **禁止**在不能编译的代码上继续修补
2. ❌ **禁止**一次性生成几千行然后交一坨不能编译的垃圾
3. ❌ **禁止**把中文长文本直接写进 C# 字符串（应该用资源文件）
4. ❌ **禁止**用反射直接修改 `CurrentMenu`
5. ❌ **禁止**在字符串中使用裸换行
6. ❌ **禁止**输出编码损坏的中文字符

## 最后交付物要求

1. **第一个 PR**：只修编码+字符串+结构，让项目**零报错编译通过**
2. **第二个 PR**：修菜单链（每条预设出身 Node1 的 InputMenuId 必须唯一）
3. **第三个 PR**：修 Patch 时序，并提供日志证明每次能切到正确菜单

---

**核心原则**：**先让代码能编译，再谈逻辑。** 不要再给我制造 40+ 个 CS1010。










































