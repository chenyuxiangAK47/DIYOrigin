# ä¿®å¤æ€»ç»“ - 2025-12-24

## ğŸ” é—®é¢˜è¯Šæ–­

ä»æ—¥å¿— `C:\ProgramData\Mount and Blade II Bannerlord\logs\rgl_log_30796.txt` åˆ†æï¼š

**å…³é”®é—®é¢˜ï¼šHarmony PatchAll å¤±è´¥**
```
[11:15:38.982] [OriginSystem] OnSubModuleLoad å¤±è´¥: Patching exception in method 
static System.Reflection.MethodBase OriginSystemMod.OnCharacterCreationFinalizedPatch::TargetMethod()
```

**å½±å“ï¼š**
- æ‰€æœ‰ Patch éƒ½æ²¡æœ‰æ³¨å†Œï¼ˆåŒ…æ‹¬è·¯ç”±ç›¸å…³çš„ Patchï¼‰
- æ²¡æœ‰çœ‹åˆ° "Harmony PatchAll å®Œæˆ" æ—¥å¿—
- æ²¡æœ‰çœ‹åˆ°ä»»ä½•è·¯ç”±ç›¸å…³æ—¥å¿—ï¼ˆSelect / Switch / Routeï¼‰

## ğŸ”§ ä¿®å¤å†…å®¹

### ä¿®å¤æ–‡ä»¶ï¼š`SubModule/OriginSystemPatches.cs`

**é—®é¢˜ï¼š** `OnCharacterCreationFinalizedPatch.TargetType()` å¯èƒ½æŠ›å¼‚å¸¸ï¼Œå¯¼è‡´æ•´ä¸ª PatchAll å¤±è´¥ã€‚

**ä¿®å¤ï¼š** åœ¨ `TargetType()` ä¸­æ·»åŠ å®Œæ•´çš„ try-catchï¼Œç¡®ä¿å³ä½¿æŸ¥æ‰¾ç±»å‹å¤±è´¥ä¹Ÿä¸æŠ›å¼‚å¸¸ã€‚

**ä¿®æ”¹ä½ç½®ï¼š** ç¬¬ 331-351 è¡Œ

**ä¿®æ”¹å‰ï¼š**
```csharp
static Type TargetType()
{
    var type = Type.GetType("SandBox.CharacterCreationContent.SandboxCharacterCreationContent, SandBox");
    if (type == null)
    {
        type = Type.GetType("TaleWorlds.CampaignSystem.CharacterCreationContent.CharacterCreationContent, TaleWorlds.CampaignSystem");
    }
    // ...
    return type;
}
```

**ä¿®æ”¹åï¼š**
```csharp
static Type TargetType()
{
    try
    {
        Type type = null;
        try
        {
            type = Type.GetType("SandBox.CharacterCreationContent.SandboxCharacterCreationContent, SandBox");
        }
        catch (Exception ex)
        {
            OriginLog.Warning($"[SlaveEscape][Patch] æŸ¥æ‰¾ SandboxCharacterCreationContent æ—¶å¼‚å¸¸: {ex.Message}");
        }
        
        if (type == null)
        {
            try
            {
                type = Type.GetType("TaleWorlds.CampaignSystem.CharacterCreationContent.CharacterCreationContent, TaleWorlds.CampaignSystem");
            }
            catch (Exception ex)
            {
                OriginLog.Warning($"[SlaveEscape][Patch] æŸ¥æ‰¾ CharacterCreationContent æ—¶å¼‚å¸¸: {ex.Message}");
            }
        }
        // ...
        return type;
    }
    catch (Exception ex)
    {
        OriginLog.Error($"[SlaveEscape][Patch] TargetType å¼‚å¸¸: {ex.Message}");
        return null; // è¿”å› null è¡¨ç¤ºè¿™ä¸ª Patch ä¸ç”Ÿæ•ˆï¼Œä½†ä¸å½±å“å…¶ä»– Patch
    }
}
```

## âœ… ä¿®å¤åŸåˆ™

æŒ‰ç…§å¿…è¯»æ–‡æ¡£çš„"PatchAll éš”ç¦»ç­–ç•¥æ¨¡æ¿"ï¼š
- âœ… ä¸€ä¸ª Patch çš„å¤±è´¥ä¸èƒ½å½±å“å…¶ä»– Patch
- âœ… å¿…é¡»æ•è·æ‰€æœ‰å¼‚å¸¸
- âœ… è¿”å› null æ—¶ä¸å½±å“å…¶ä»–åŠŸèƒ½

## ğŸ“‹ é¢„æœŸç»“æœ

ä¿®å¤åï¼Œé‡æ–°è¿è¡Œæ¸¸æˆåº”è¯¥çœ‹åˆ°ï¼š

1. **Harmony PatchAll æˆåŠŸï¼š**
   ```
   [OriginSystem] Harmony PatchAll å®Œæˆ
   ```

2. **è·¯ç”±ç›¸å…³ Patch æ³¨å†ŒæˆåŠŸï¼š**
   - `OnNarrativeMenuOptionSelectedPatch` åº”è¯¥æ³¨å†Œ
   - `TrySwitchToNextMenuPatch` åº”è¯¥æ³¨å†Œ

3. **è·¯ç”±æ—¥å¿—å‡ºç°ï¼š**
   - `Select: menu=origin_type_selection option=preset_origin_option`
   - `Switch: cur=origin_type_selection opt=preset_origin_option resolved=...`
   - `[Route] ä½¿ç”¨ PendingMenuSwitch: ...`

## ğŸ§ª æµ‹è¯•æ­¥éª¤

1. é‡æ–°ç¼–è¯‘ï¼ˆå·²å®Œæˆ âœ“ï¼‰
2. è¿è¡Œæ¸¸æˆ
3. è¿›å…¥è§’è‰²åˆ›å»º
4. é€‰æ‹©é¢„è®¾å‡ºèº«
5. æŸ¥çœ‹æ—¥å¿—ï¼Œç¡®è®¤ï¼š
   - `[OriginSystem] Harmony PatchAll å®Œæˆ`
   - `Select: menu=...`
   - `Switch: cur=...`

## ğŸ“ ä¿®æ”¹ç»Ÿè®¡

- **ä¿®æ”¹æ–‡ä»¶æ•°ï¼š** 1
- **ä¿®æ”¹è¡Œæ•°ï¼š** ~20 è¡Œï¼ˆç¬¦åˆ â‰¤ 20 è¡ŒåŸåˆ™ï¼‰
- **ç¼–è¯‘çŠ¶æ€ï¼š** âœ… 0 errors 0 warnings








































